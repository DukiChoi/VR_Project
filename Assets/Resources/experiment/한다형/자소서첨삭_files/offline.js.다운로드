(function(g){var window=this;'use strict';var oJS=function(m){var c=new g.Xs("und",new g.p3("Default","und",!0));c.captionTracks=m.captionTracks;return c},F7Q=function(m){return new g.xf(function(c,W){var A=m.length,p=[];
if(A)for(var R=function(N,Z){A--;p[N]=Z;A==0&&c(p)},L=function(N){W(N)},M,b=0;b<m.length;b++)M=m[b],g.kCm(M,g.P$(R,b),L);
else c(p)})},Bu=function(m){this.j=m},vu=function(){Bu.apply(this,arguments)},Qc9=function(){vu.apply(this,arguments)},gJX=function(){vu.apply(this,arguments)},wnh=function(){vu.apply(this,arguments)},CnQ=function(){vu.apply(this,arguments)},Jrh=function(){vu.apply(this,arguments)},Veh=function(){vu.apply(this,arguments)},HWd=function(){Bu.apply(this,arguments)},xNd=function(){vu.apply(this,arguments)},l6H=function(){vu.apply(this,arguments)},qPQ=function(){vu.apply(this,arguments)},T3G=function(){vu.apply(this,
arguments)},yrG=function(){vu.apply(this,arguments)},zLr=function(){vu.apply(this,arguments)},eLG=function(){vu.apply(this,arguments)},dNG=function(){vu.apply(this,arguments)},ter=function(){vu.apply(this,arguments)},G14=function(){vu.apply(this,arguments)},DNX=function(){vu.apply(this,arguments)},K7Q=function(){vu.apply(this,arguments)},B3v=function(){Bu.apply(this,arguments)},vJH=function(){vu.apply(this,arguments)},jcc=function(){vu.apply(this,arguments)},a6h=function(){vu.apply(this,arguments)},
ujv=function(){vu.apply(this,arguments)},nJc=function(){vu.apply(this,arguments)},rrr=function(){vu.apply(this,arguments)},hLr=function(){vu.apply(this,arguments)},sc4=function(){vu.apply(this,arguments)},SPa=function(){vu.apply(this,arguments)},EJa=function(){Bu.apply(this,arguments)},YPa=function(){Bu.apply(this,arguments)},f6G=function(){Bu.apply(this,arguments)},iW4=function(){vu.apply(this,arguments)},I6r=function(){vu.apply(this,arguments)},PnX=function(){vu.apply(this,arguments)},UNG=function(){vu.apply(this,
arguments)},k1c=function(){vu.apply(this,arguments)},XnH=function(){vu.apply(this,arguments)},mPh=function(){vu.apply(this,arguments)},cBQ=function(){vu.apply(this,arguments)},WB4=function(){vu.apply(this,arguments)},AB9=function(){vu.apply(this,arguments)},pC9=function(){vu.apply(this,arguments)},Rzh=function(){vu.apply(this,arguments)},LBS=function(){vu.apply(this,arguments)},OZ4=function(){vu.apply(this,arguments)},MG4=function(){vu.apply(this,arguments)},bZh=function(){vu.apply(this,arguments)},
$Pi=function(){vu.apply(this,arguments)},NUS=function(){vu.apply(this,arguments)},ZZi=function(){vu.apply(this,arguments)},oYa=function(){vu.apply(this,arguments)},FBS=function(){vu.apply(this,arguments)},QeQ=function(){vu.apply(this,arguments)},gYr=function(){vu.apply(this,arguments)},wCc=function(){vu.apply(this,arguments)},CEa=function(){vu.apply(this,arguments)},JBd=function(){Bu.apply(this,arguments)},VGG=function(){vu.apply(this,arguments)},HZG=function(){vu.apply(this,arguments)},xPh=function(){vu.apply(this,
arguments)},lF4=function(){vu.apply(this,arguments)},qAd=function(){vu.apply(this,arguments)},TUS=function(){vu.apply(this,arguments)},yB4=function(){vu.apply(this,arguments)},zzc=function(){vu.apply(this,arguments)},ezh=function(){vu.apply(this,arguments)},dPv=function(){vu.apply(this,arguments)},tGd=function(){vu.apply(this,arguments)},GQ9=function(){vu.apply(this,arguments)},DPX=function(){vu.apply(this,arguments)},KBa=function(){vu.apply(this,arguments)},BUi=function(){vu.apply(this,arguments)},
vY4=function(){vu.apply(this,arguments)},jev=function(){vu.apply(this,arguments)},aF9=function(){vu.apply(this,arguments)},u$i=function(){vu.apply(this,arguments)},nYH=function(){vu.apply(this,arguments)},rBi=function(){vu.apply(this,arguments)},hz4=function(){vu.apply(this,arguments)},seX=function(){vu.apply(this,arguments)},SAX=function(){vu.apply(this,arguments)},EYX=function(){vu.apply(this,arguments)},YAX=function(){vu.apply(this,arguments)},fFQ=function(){vu.apply(this,arguments)},iZv=function(){vu.apply(this,
arguments)},IFh=function(){vu.apply(this,arguments)},PEd=function(m){m=m.key||m.id;
if(!m)throw Error("Entity key is missing");return m},UPr=function(){if(j3)return j3();
var m={};j3=g.LF("PersistentEntityStoreDb",{IM:(m.EntityStore={YL:1},m.EntityAssociationStore={YL:2},m),shared:!1,upgrade:function(c,W){W(1)&&g.h5(g.v0(c,"EntityStore",{keyPath:"key"}),"entityType","entityType");W(2)&&(c=g.v0(c,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.h5(c,"byParentEntityKey","parentEntityKey"),g.h5(c,"byChildEntityKey","childEntityKey"))},
version:3});return j3()},kQh=function(m){return g.P0(UPr(),m)},XC4=function(m){return g.P0((0,g.inh)(),m)},ap=function(m){this.token=m},uB=function(m,c){c=c===void 0?{}:c;
g.X7.call(this,g.IMh[m],Object.assign({},{name:"PESEncoderError",type:m},c));this.type=m;this.level="WARNING";Object.setPrototypeOf(this,uB.prototype)},mGr=function(m){return new uB("WRONG_DATA_TYPE",{BT:m})},ck4=function(m){return m instanceof Error?new uB("UNKNOWN_ENCODE_ERROR",{nA:m.message}):new uB("UNKNOWN_ENCODE_ERROR")},Wgh=function(m){return m instanceof Error?new uB("UNKNOWN_DECODE_ERROR",{nA:m.message}):new uB("UNKNOWN_DECODE_ERROR")},Aka=function(m,c){m=m instanceof uB?m:c(m);
g.aZ(m);throw m;},pYr=function(){},R0Q=function(m,c,W){try{return m.K(c,W)}catch(A){Aka(A,ck4)}},Lgh=function(m){m=(new TextEncoder).encode(m).subarray(0,16);
var c=new Uint8Array(16);c.set(m);return c},nk=function(m){this.j=m},MmH=function(m){var c=O$Q[m];
if(c)return c;g.uf(new g.X7("Entity model not found.",{entityType:m}))},b$H=function(m,c){this.j=m;
this.V=c;this.K={}},Neh=function(m,c){a:{m=$GX(m.V,c.version);
try{var W=m.V(c.data,c.key);break a}catch(A){Aka(A,Wgh)}W=void 0}return W},rW=function(m,c,W){return m.j.objectStore("EntityStore").get(c).then(function(A){if(A){if(W&&A.entityType!==W)throw Error("Incorrect entity type");
return Neh(m,A)}})},hO=function(m,c,W){return W?(W=W.map(function(A){return rW(m,A,c)}),g.dx.all(W)):m.j.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(c)).then(function(A){return A.map(function(p){return Neh(m,p)})})},S3=function(m,c,W){var A=PEd(c),p=$GX(m.V,1),R=Object.assign({},c);
return m.j.objectStore("EntityStore").get(A).then(function(L){if(L){if(L.entityType!==W)throw Error("Incorrect entity type");R.entityMetadata||(L=Neh(m,L),R.entityMetadata=L.entityMetadata)}}).then(function(){var L={key:A,
entityType:W,data:R0Q(p,R,A),version:1};return g.dx.all([g.uP(m.j.objectStore("EntityStore"),L),Z$c(m,R,W)])}).then(function(){sZ(m,A,W);
return A})},oMG=function(m,c,W){c=c.map(function(A){return S3(m,A,W)});
return g.dx.all(c)},EZ=function(m,c,W){if(W==null?0:W.a6){var A=new Set;
return Fg9(m,c,A).then(function(){for(var R=[],L=g.H(A),M=L.next();!M.done;M=L.next())R.push(EZ(m,M.value));return g.dx.all(R).then(function(){})})}var p=g.Ng(c).entityType;
return g.dx.all([m.j.objectStore("EntityStore").delete(c),QTG(m,c)]).then(function(){sZ(m,c,p)})},gMv=function(m,c){return g.YK(m.j.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(c)},function(W){return g.dx.all([W.delete(),
QTG(m,W.cursor.primaryKey)]).then(function(){sZ(m,W.cursor.primaryKey,c);return g.SW(W)})})},wYr=function(m,c,W,A){var p=$GX(m.V,1);
return rW(m,c,A).then(function(R){if(R){R=g.Hv(R,W);var L={key:c,entityType:A,data:R0Q(p,R,c),version:1};return g.dx.all([g.uP(m.j.objectStore("EntityStore"),L),Z$c(m,R,A)])}}).then(function(){sZ(m,c,A);
return c})},sZ=function(m,c,W){var A=m.K[W];
A||(A=new Set,m.K[W]=A);A.add(c)},CG9=function(m,c,W){var A=PEd(c);
W=MmH(W);if(!W)return g.dx.resolve([]);W=new W(c);m=m.j.objectStore("EntityAssociationStore");c=[];W=g.H(W.V());for(var p=W.next();!p.done;p=W.next())c.push(g.uP(m,{parentEntityKey:A,childEntityKey:p.value}));return g.dx.all(c).then(function(R){return R.map(function(L){return L[1]})})},QTG=function(m,c){return m.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(c))},Z$c=function(m,c,W){var A=PEd(c);
return QTG(m,A).then(function(){return CG9(m,c,W)})},Fg9=function(m,c,W){if(W.has(c))return g.dx.resolve(void 0);
W.add(c);return JkH(m,c).then(function(A){return m.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(c)).then(function(){return A})}).then(function(A){var p=g.dx.resolve(void 0);
A=g.H(A);for(var R=A.next(),L={};!R.done;L={wV:void 0},R=A.next())L.wV=R.value,p=p.then(function(M){return function(){return Fg9(m,M.wV,W)}}(L));
return p}).then(function(){})},JkH=function(m,c){var W=m.j.objectStore("EntityAssociationStore");
return W.index("byParentEntityKey").getAll(IDBKeyRange.only(c)).then(function(A){var p=[];A=g.H(A);for(var R=A.next();!R.done;R=A.next())R=R.value,p.push(W.index("byChildEntityKey").getAll(R.childEntityKey));return g.dx.all(p)}).then(function(A){var p=[];
A=g.H(A);for(var R=A.next();!R.done;R=A.next())R=R.value,R.length===1&&p.push(R[0].childEntityKey);return p})},Yu=function(){},Vmd=function(){this.j={};
this.j[0]=new Yu;if(!g.zc("aes_pes_encoder_killswitch")){var m=this.j;try{var c=g.mn();var W=Lgh(c);var A=new nk(new g.zK(W),new g.yY(W))}catch(p){throw m=p instanceof Error?new uB("KEY_CREATION_FAILED",{nA:p.message}):new uB("KEY_CREATION_FAILED"),g.aZ(m),m;}m[1]=A}},$GX=function(m,c){c=c===void 0?0:c;
m=m.j[c];if(!m)throw c=new uB("INVALID_ENCODER_VERSION",{BT:c}),g.aZ(c),c;return m},fk=function(m,c){g.n.call(this);
this.token=m;this.j=c;this.observers=[];m=new g.um.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.mn());m.onmessage=this.V.bind(this);this.channel=m},iB=function(m,c,W){var A,p,R,L;
return g.D(function(M){if(M.j==1)return g.t(M,kQh(m.token),2);if(M.j!=3)return A=M.V,g.t(M,g.a1(A,["EntityStore","EntityAssociationStore"],c,function(b){p=new b$H(b,m.j);return W(p)}),3);
R=M.V;p&&(L=p.K,Object.keys(L).length>0&&(m.channel.postMessage(L),H$G(m,L)));return M.return(R)})},Ip=function(m,c,W){return iB(m,{mode:"readwrite",
k$:!0},function(A){return S3(A,c,W)})},xG4=function(m,c){return iB(m,{mode:"readwrite",
k$:!0},function(W){return oMG(W,c,"offlineOrchestrationActionWrapperEntity")})},lPH=function(m,c){return iB(m,{mode:"readwrite",
k$:!0},function(W){return EZ(W,c)})},qOQ=function(m){return iB(m,{mode:"readwrite",
k$:!0},function(c){return gMv(c,"videoPlaybackPositionEntity")})},Pu=function(m,c,W){return iB(m,{mode:"readonly",
k$:!0},function(A){return rW(A,c,W)})},UZ=function(m,c,W){return iB(m,{mode:"readonly",
k$:!0},function(A){return hO(A,c,W)})},H$G=function(m,c){m=g.H(m.observers);
for(var W=m.next();!W.done;W=m.next())W=W.value,W(c)},Te9=function(){var m,c,W;
return g.D(function(A){if(A.j==1)return g.JY(A,2),g.t(A,g.pF(),4);if(A.j!=2){m=A.V;if(!m||!g.c0()||typeof g.um.BroadcastChannel==="undefined")return A.return();c=new Vmd;return A.return(new fk(m,c))}W=g.lm(A);W instanceof Error&&g.aZ(W);return A.return()})},ku=function(){yki||(yki=Te9());
return yki},z0Q=function(m){var c;
m=(c=m.options)==null?void 0:c.persistenceOption;return m==="ENTITY_PERSISTENCE_OPTION_PERSIST"||m==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},e0H=function(m){var c;
return g.D(function(W){return W.j==1?g.t(W,ku(),2):(c=W.V)?g.t(W,iB(c,"readwrite",function(A){for(var p={},R=g.H(m),L=R.next(),M={};!L.done;M={YY:void 0,p8:void 0},L=R.next())M.YY=L.value,M.YY.entityKey&&z0Q(M.YY)&&(M.p8=g.ys(M.YY.payload),L=void 0,M.YY.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(L=function(b){return function(){return S3(A,b.YY.payload[b.p8],b.p8)}}(M)),M.YY.type==="ENTITY_MUTATION_TYPE_DELETE"&&(L=function(b){return function(){return EZ(A,b.YY.entityKey)}}(M)),M.YY.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(L=function(b){return function(){return wYr(A,b.YY.entityKey,b.YY.payload[b.p8],b.p8)}}(M)),L&&(p[M.YY.entityKey]=p[M.YY.entityKey]?p[M.YY.entityKey].then(L):L()));
return g.dx.all(Object.values(p))}),0):W.return()})},dGd=function(m){var c;
return g.D(function(W){if(W.j==1){c=m.mutations;if(!c||c.length<=0)return W.return();if(g.IQ){var A={type:"ENTITY_LOADED"};c!==void 0&&(A.payload=c);g.IQ.dispatch(A)}return g.t(W,e0H(c),2)}c.length=0;g.CN(W)})},tma=function(m){return m!==void 0},GjX=function(m){var c=g.xZ();
c=Object.assign({},c);m=Object.assign({},m);for(var W in c)m[W]?(c[W]!==4&&(c[W]=m[W]),delete m[W]):c[W]!==2&&(c[W]=4);Object.assign(c,m);g.S_$(c);JSON.stringify(c);return c},DG4=function(m){var c,W;
return g.D(function(A){if(A.j==1)return g.t(A,g.pF(),2);if(A.j!=3)return(c=A.V)?g.t(A,g.Ta(c),3):A.return();W=A.V;return A.return(g.a1(W,["index","media","captions"],{mode:"readwrite",k$:!0},function(p){var R=IDBKeyRange.bound(m+"|",m+"~");p=[p.objectStore("index").delete(R),p.objectStore("media").delete(R),p.objectStore("captions").delete(R)];return g.dx.all(p).then(function(){})}))})},Kgv=function(){var m,c;
return g.D(function(W){if(W.j==1)return g.t(W,g.pF(),2);if(W.j!=3){m=W.V;if(!m)throw g.zG("rvdfd");return g.t(W,g.Ta(m),3)}c=W.V;return W.return(g.a1(c,["index","media"],{mode:"readwrite",k$:!0},function(A){var p={};return g.sH(A.objectStore("index"),{},function(R){var L=R.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),M=g.dx.resolve(void 0);if(L){var b=L[1];L=L[2];p[b]=p[b]||{};var N;p[b][L]=g.Ixy((N=R.getValue())==null?void 0:N.fmts)}else M=R.delete().then(function(){});
return g.dx.all([g.SW(R),M]).then(function(Z){return g.H(Z).next().value})}).then(function(){for(var R={},L=g.H(Object.keys(p)),M=L.next();!M.done;M=L.next()){M=M.value;
var b=p[M].v;R[M]=p[M].a&&b?1:2}var N=GjX(R);return g.ej5(A.objectStore("media"),{},function(Z){var F=Z.cursor.key.match(g.X71);F&&R[F[1]]||A.objectStore("media").delete(Z.cursor.key);return g.Jn1(Z)}).then(function(){return N})})}))})},Be4=function(m,c){var W,A;
return g.D(function(p){if(p.j==1)return g.t(p,g.pF(),2);if(p.j!=3){W=p.V;if(!W)throw g.zG("wct");return g.t(p,g.Ta(W),3)}A=p.V;return g.t(p,g.a1(A,["captions"],{mode:"readwrite",k$:!0},function(R){var L=[];R=R.objectStore("captions");for(var M=0;M<c.length;M++){var b=g.uP(R,c[M],m+"|"+c[M].metadata.vss_id);L.push(b)}return g.dx.all(L)}),0)})},vM4=function(m){var c,W,A;
return g.D(function(p){if(p.j==1)return c=IDBKeyRange.bound(m+"|",m+"~"),g.t(p,g.pF(),2);if(p.j!=3){W=p.V;if(!W)throw g.zG("gactfv");return g.t(p,g.Ta(W),3)}A=p.V;return p.return(A.getAll("captions",c))})},jT4=function(m){return g.D(function(c){g.qU(m,0);
return c.return(DG4(m))})},aPc=function(m){return{context:g.o2(),
videoIds:m}},uSd=function(m){return{context:g.o2(),
playlistIds:m}},nMh=function(m){return{context:g.o2(),
offlinePlaylistSyncChecks:m}},rk4=function(){this.j=new Map},sT9=function(){h0r||(h0r=new rk4);
return h0r},SOh=function(m,c){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:m},metadata:c,statusCode:void 0,csn:void 0,can:void 0}},EMa=function(m,c,W){if(!W){var A=A===void 0?!1:A;
W=m.j.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!W||A)W=g.zf(16),m.j.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",W)}m={flowNonce:W,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:c.eventType};c.metadata&&(m.flowMetadata=c.metadata);c.statusCode!==void 0&&(m.flowEventStatus=c.statusCode);c.csn&&(m.csn=c.csn);c.can&&(m.can=c.can);g.Q8("flowEvent",m,void 0)},YOv=function(m){var c,W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5,X,S,P,V,Y,m4,xh,Wr,er,U5,pd,wi,T,z,d;
return g.D(function(K){if(K.j==1)return g.t(K,iB(m,{mode:"readonly",k$:!0},function(a){return hO(a,"playbackData").then(function(c$){var RU=c$.map(function(gE){return gE.transfer}).filter(function(gE){return!!gE}),LN=c$.map(function(gE){return gE.offlineVideoPolicy}).filter(function(gE){return!!gE}),v=c$.filter(function(gE){return!!gE.key}).map(function(gE){return g.Zk(g.Ng(gE.key).entityId,"downloadStatusEntity")});
RU=hO(a,"transfer",RU);LN=hO(a,"offlineVideoPolicy",LN);v=hO(a,"downloadStatusEntity",v);var NK=RU.then(function(gE){gE=gE.reduce(function(bm,DQ){(DQ==null?0:DQ.offlineVideoStreams)&&bm.push.apply(bm,g.l(DQ.offlineVideoStreams));return bm},[]).filter(function(bm){return!!bm});
return hO(a,"offlineVideoStreams",gE)});
return g.dx.all([RU,LN,NK,v]).then(function(gE){var bm=g.H(gE);gE=bm.next().value;var DQ=bm.next().value;var NQ=bm.next().value;bm=bm.next().value;return[c$,gE,DQ,NQ,bm]})})}),2);
if(K.j!=3)return c=K.V,g.t(K,iB(m,{mode:"readonly",k$:!0},function(a){return hO(a,"mainDownloadsListEntity").then(function(c$){var RU,LN;return(LN=(RU=c$[0])==null?void 0:RU.downloads)!=null?LN:[]})}),3);
W=K.V;A=g.H(c);p=A.next().value;R=A.next().value;L=A.next().value;M=A.next().value;b=A.next().value;N=p;Z=R;F=L;Q=M;w=b;C={};x={};q={};y={};e={};G=[];B=g.H(Z);for(u=B.next();!u.done;u=B.next())(E=u.value)&&(C[E.key]=E);I=g.H(F);for(AY=I.next();!AY.done;AY=I.next())(O5=AY.value)&&(x[O5.key]=O5);X=g.H(w);for(S=X.next();!S.done;S=X.next())(P=S.value)&&(q[P.key]=P);V=g.H(Q);for(Y=V.next();!Y.done;Y=V.next())(m4=Y.value)&&(y[m4.key]=m4);xh=g.H(W);for(Wr=xh.next();!Wr.done;Wr=xh.next())er=Wr.value,U5=void 0,
e[(U5=er.videoItem)!=null?U5:""]=!0,er.videoItem&&(wi=pd=void 0,T=(wi=(pd=g.Ng(er.videoItem))==null?void 0:pd.entityId)!=null?wi:"",G.push({externalVideoId:T}));z=N.filter(function(a){if(!a||!a.key||!a.offlineVideoPolicy)return!1;a=g.Ng(a.key).entityId;a=g.Zk(a,"downloadStatusEntity");var c$;return!(a&&((c$=q[a])==null?void 0:c$.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
d=z.map(function(a){var c$=C[a.transfer],RU=[];if(c$==null?0:c$.offlineVideoStreams)for(var LN=g.H(c$.offlineVideoStreams),v=LN.next();!v.done;v=LN.next())(v=y[v.value])&&RU.push(v);LN=x[a.offlineVideoPolicy];v=e;var NK=a==null?void 0:a.playerResponseTimestamp,gE=g.Ng(LN.key).entityId;a=g.Zk(gE,"mainVideoEntity");if(LN.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var bm="OFFLINE_VIDEO_STATE_DISABLED";LN.expirationTimestamp&&Number(LN.expirationTimestamp)<Date.now()/1E3&&(bm="OFFLINE_VIDEO_STATE_EXPIRED")}else if(LN.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")bm="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(c$==null?void 0:c$.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":bm="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":bm="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":bm="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":bm="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":bm="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":bm="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:bm="OFFLINE_VIDEO_STATE_UNKNOWN"}if(bm==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(c$==null?void 0:c$.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":bm="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":bm="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":bm=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}gE={id:gE,videoState:bm};if(c$==null?0:c$.cotn)gE.cotn=c$.cotn;if(c$==null?0:c$.maximumDownloadQuality)gE.selectedVideoQuality=c$==null?void 0:c$.maximumDownloadQuality;if(c$==null?0:c$.lastProgressTimeMs)gE.lastProgressTimeMs=c$.lastProgressTimeMs;NK&&(gE.playerResponseSavedTimeMs=String(Number(NK)*1E3));c$=String;NK=0;RU=g.H(RU);for(bm=RU.next();!bm.done;bm=RU.next())if(bm=bm.value,bm.streamsProgress){bm=g.H(bm.streamsProgress);for(var DQ=bm.next();!DQ.done;DQ=
bm.next()){var NQ=void 0;NK+=Number((NQ=DQ.value.numBytesDownloaded)!=null?NQ:0)}}gE.downloadedBytes=c$(NK);gE.selectedOfflineMode=v[a]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";LN.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(gE.offlinePlaybackDisabledReason=LN.offlinePlaybackDisabledReason);return gE});
return K.return({offlineVideos:d,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:G}}})})},fPa=function(){this.locks=navigator.locks},i$4=function(){try{var m=g.rE("ytglobal.locks_");
if(m)return m;var c;if(c=navigator){var W=navigator;c="locks"in W&&!!W.locks}if(c)return g.um.localStorage&&g.um.localStorage.getItem("noop"),m=new fPa,g.nN("ytglobal.locks_",m),m}catch(A){}},Xc=function(){},IPh=function(){},PGv=function(m){if(m.includes(":"))throw Error("Invalid user cache name: "+m);
return m+":"+g.mn("CacheStorage get")},UGH=function(){return g.D(function(m){if(mV!==void 0)return m.return(mV);
mV=new Promise(function(c){var W;return g.D(function(A){switch(A.j){case 1:return g.JY(A,2),g.t(A,cF.open("test-only"),4);case 4:return g.t(A,cF.delete("test-only"),5);case 5:g.H$(A,3);break;case 2:if(W=g.lm(A),W instanceof Error&&W.name==="SecurityError")return c(!1),A.return();case 3:c("caches"in window),g.CN(A)}})});
return m.return(mV)})},XYG=function(){return g.D(function(m){if(m.j==1)return g.t(m,UGH(),2);
if(!m.V)return m.return(void 0);kja||(kja=new IPh);return m.return(kja)})},WF=function(m,c,W){g.uf(new g.X7("Woffle: "+m,W?{cotn:W}:""));
c instanceof Error&&g.uf(c)},mRi=function(m){var c;
return g.D(function(W){if(W.j==1)return g.t(W,YOv(m),2);c=W.V;g.Q8("offlineStateSnapshot",c);g.CN(W)})},Au=function(m){g.n.call(this);
var c=this;this.api=m;this.Km={E2g:function(){return c.j},
Qvg:function(){return c.V}};
typeof g.um.BroadcastChannel!=="undefined"&&(this.j=new g.um.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.mn()),this.j.onmessage=this.K.bind(this),this.V=new g.um.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.mn()),this.V.onmessage=this.L.bind(this))},p0=function(m,c){m.api.r_("onOfflineOperationFailure",c);
var W;(W=m.j)==null||W.postMessage(c)},cU9=function(m,c,W,A){var p=this;
this.N=m;this.W=c;this.visibility=W;this.G=A;this.U=this.X=this.B=this.K=this.j=!1;this.L=new g.Rv(function(){p.Yc()});
this.Km={h1:function(){return p.V},
Yc:function(){p.Yc()},
Jlq:function(){return p.L}};
this.visibility.subscribe("visibilitystatechange",function(){p.cP()})},W5X=function(m){if(!m.K&&!m.j){var c=i$4();
if(c){m.K=!0;var W=g.mn("OfflineLockManager");c.request("woffle_orchestration_leader:"+W,{},function(){var A,p,R,L;return g.D(function(M){switch(M.j){case 1:return g.JY(M,2),m.V=new g.ln,m.j=!0,m.K=!1,g.t(M,m.N(),4);case 4:return g.t(M,m.V.promise,5);case 5:g.H$(M,0);break;case 2:A=g.lm(M),((R=(p=m).G)==null?0:R.call(p,"wo_relinquish_leadership_on_lock_request_error"))||m.Yc(),A instanceof Error&&(L=A,L.args=[{name:"WoLockManagerError",sx:A.name}],g.aZ(L)),g.CN(M)}})})}}},AUh=function(m){m.j&&(m.U=
!0,Rj(m))},pGX=function(m,c){m.j&&(m.B=c,Rj(m))},R6v=function(m,c){m.j&&(m.X=c,Rj(m))},Rj=function(m){m.X&&m.B&&m.U&&m.visibility.isBackground()?g.Lx(m.L,6E4):m.L.stop()},L0=function(m){var c;
m.offlineDeleteReason=(c=m.offlineDeleteReason)!=null?c:"OFFLINE_DELETE_REASON_UNKNOWN";var W;m.offlineModeType=(W=m.offlineModeType)!=null?W:"OFFLINE_NOW";g.Q8("offlineDeleteEvent",m)},OU=function(m,c){var W=c.videoId;
var A=c.gr;c=c.offlineModeType;m.encryptedVideoId=W;m.cotn=A==null?void 0:A.cotn;m.offlineabilityFormatType=A==null?void 0:A.maximumDownloadQuality;var p;m.isRefresh=(p=A==null?void 0:A.isRefresh)!=null?p:!1;var R;m.softErrorCount=(R=A==null?void 0:A.transferRetryCount)!=null?R:0;m.offlineModeType=c!=null?c:"OFFLINE_NOW";(m.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&m.statusType==="UNKNOWN_STATUS_TYPE"||!m.transferStatusType&&!m.statusType)&&g.uf(Error("Woffle unknown transfer status"));
g.Q8("offlineTransferStatusChanged",m)},L54=function(m,c,W,A){A={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!A};c&&W&&(c=Math.floor(c/1024).toFixed(),W=Math.floor(W/1024).toFixed(),A.alreadyDownloadedKbytes=c,A.totalFetchedKbytes=c,A.totalContentKbytes=W);OU(A,m)},OoH=function(m){OU({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},m)},MfQ=function(m){switch(m){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Mu=function(m){var c,W,A;
return((A=(c=m.actionMetadata)==null?void 0:(W=c.retryScheduleIntervalsInSeconds)==null?void 0:W.length)!=null?A:0)>0},b_=function(m){return m.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!m.entityKey},$O=function(m){return m.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!m.entityKey},Nu=function(m){return m.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!m.entityKey},boG=function(m){return m.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!m.entityKey},
Zg=function(m,c,W,A,p){p=p===void 0?!1:p;
var R,L,M,b,N,Z;return g.D(function(F){if(F.j==1)return R=g.Zk(m,c),L=g.Zk(m,"downloadStatusEntity"),g.t(F,iB(W,{mode:"readonly",k$:!0},function(Q){return g.dx.all([rW(Q,R,c),rW(Q,L,"downloadStatusEntity")])}),2);
M=F.V;b=M.length?M[0]:void 0;if(!b)return F.qh(0);N=$Rc;if(Z=M.length>1?M[1]:void 0){if(Z.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!p)return F.return();Z.downloadState=A}else Z={key:L,downloadState:A};g.Sy(b,N,Z);return g.t(F,iB(W,{mode:"readwrite",k$:!0},function(Q){return g.dx.all([S3(Q,b,c),S3(Q,Z,"downloadStatusEntity")])}),0)})},oj=function(m,c){return m.actionType===c.actionType&&m.entityKey===c.entityKey},FW=function(m,c){if(m&&m.transferState!=="TRANSFER_STATE_COMPLETE"&&m.transferState!==
"TRANSFER_STATE_FAILED"){var W=g.Ng(m.key).entityId;
OU({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:W,gr:m,offlineModeType:c})}},Qj=function(m){if(!m||!m.thumbnails)return[];
var c=[];m=g.H(m.thumbnails);for(var W=m.next();!W.done;W=m.next())W=W.value,W.url&&c.push(W.url);return c},N_G=function(m,c,W){W=W===void 0?[]:W;
var A,p,R,L,M,b,N,Z,F,Q,w,C,x;return g.D(function(q){if(q.j==1)return W.length?g.t(q,UZ(m,c),2):q.return([]);A=q.V;p=new Set;R=g.H(A);for(L=R.next();!L.done;L=R.next())if(M=L.value,b=M.id||M.key)N=g.Ng(b).entityId,p.add(N);Z=[];F=g.H(W);for(Q=F.next();!Q.done;Q=F.next())w=Q.value,C=w.offlineVideoData,x=void 0,((x=C)==null?0:x.videoId)&&!p.has(C.videoId)&&Z.push(w);return q.return(Z)})},ZoG=function(m,c,W){return new g.aQ(m,{cotn:c,
raw_player_response:W,download_media:!0,start:Infinity,disable_watch_next:!0})},ocS=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},gP=function(m,c,W,A,p,R,L,M,b,N,Z){this.entityType=m;
this.actionId=c;this.action=W;this.parentActionId=A;this.rootActionId=p===void 0?c:p;this.childActionIds=R;this.prereqActionId=L;this.postreqActionIds=M;this.hasChildActionFailed=N;this.retryScheduleIndex=0;this.j=Z||Date.now();this.retryScheduleIndex=b||0},wP=function(m){if(!m.key)throw Error("Entity key is required.");
if(!m.actionProto)throw Error("OfflineOrchestrationAction is required.");var c=g.Ng(m.key),W=g.Ng(m.actionProto.entityKey);return new gP(W.entityType,c.entityId,m.actionProto,m.parentActionId,m.rootActionId,m.childActionIds,m.prereqActionId,m.postreqActionIds,m.retryScheduleIndex,m.hasChildActionFailed,Number(m.enqueueTimeSec)*1E3)},C0=function(m){return{key:g.Zk(m.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:m.action,parentActionId:m.parentActionId,rootActionId:m.rootActionId,childActionIds:m.childActionIds,prereqActionId:m.prereqActionId,postreqActionIds:m.postreqActionIds,retryScheduleIndex:m.retryScheduleIndex,hasChildActionFailed:m.hasChildActionFailed,enqueueTimeSec:(m.j/1E3).toFixed()}},F5c=function(){var m;
return g.D(function(c){return c.j==1?g.t(c,XYG(),2):(m=c.V)?c.return(m.delete("yt-player-local-img")):c.return(!0)})},Ju=function(m){var c,W;
return g.D(function(A){if(A.j==1)return g.t(A,XYG(),2);if(A.j!=3){c=A.V;if(!c)throw Error("Cache API not supported");return m.length?g.t(A,c.open("yt-player-local-img"),3):A.return()}W=A.V;return g.t(A,Promise.all(m.map(function(p){return W.delete(p)})),0)})},Vj=function(m){var c,W;
return g.D(function(A){if(A.j==1)return g.t(A,XYG(),2);if(A.j!=3){c=A.V;if(!c)throw Error("Cache API not supported");return m.length?g.t(A,c.open("yt-player-local-img"),3):A.return()}W=A.V;return g.t(A,W.addAll(m),0)})},HF=function(m,c,W,A,p){var R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5,X,S,P,V,Y,m4,xh,Wr,er,U5;
return g.D(function(pd){switch(pd.j){case 1:return R=g.Zk(m,"mainVideoEntity"),L=g.Zk(m,"ytMainChannelEntity"),M=g.Zk(m,"transfer"),b=g.Zk(m,"videoDownloadContextEntity"),g.t(pd,iB(c,{mode:"readonly",k$:!0},function(wi){return g.dx.all([rW(wi,R,"mainVideoEntity"),rW(wi,L,"ytMainChannelEntity"),rW(wi,M,"transfer"),rW(wi,b,"videoDownloadContextEntity"),hO(wi,"ytMainChannelEntity"),hO(wi,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:N=pd.V;Z=g.H(N);F=Z.next().value;Q=Z.next().value;w=Z.next().value;C=Z.next().value;x=Z.next().value;q=Z.next().value;y=F;e=Q;G=w;B=C;u=x;E=q;if(!y&&!e){pd.qh(3);break}I=y?Qj(y.thumbnail):[];if(!e){AY=[];pd.qh(4);break}return g.t(pd,Q3X(e,u),5);case 5:AY=pd.V;case 4:return O5=AY,g.t(pd,Ju(I.concat(O5)),3);case 3:X=[];S=g.Zk(m,"downloadStatusEntity");P=g.H(E);for(V=P.next();!V.done;V=P.next())Y=V.value,m4=g.Ng(Y.key).entityId,xh=wP(Y),Wr=g.Ng(xh.action.entityKey).entityId,m4!==m&&Wr!==m||oj(W,
Y.actionProto)||X.push(Y.key);return g.t(pd,iB(c,{mode:"readwrite",k$:!0},function(wi){var T=X.map(function(z){return EZ(wi,z)});
T.push(EZ(wi,R,{a6:!0}));T.push(EZ(wi,S,{a6:!0}));return g.dx.all(T)}),7);
case 7:U5=(er=B)==null?void 0:er.offlineModeType,p&&(L0(p),p.offlineModeType&&(U5=p.offlineModeType)),FW(G,U5),p0(A,{entityKey:R,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.CN(pd)}})},Coc=function(m,c,W,A){var p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5,X,S,P,V,Y,m4,xh,Wr,er,U5,pd,wi,T,z,d,K,a,c$,RU,LN,v,NK,gE,bm,DQ,NQ,hc,F0;
return g.D(function(Yy){switch(Yy.j){case 1:return p=g.Zk(m,"mainPlaylistEntity"),R=g.Zk(m,"ytMainChannelEntity"),g.t(Yy,iB(c,{mode:"readonly",k$:!0},function(nn){return g.dx.all([rW(nn,p,"mainPlaylistEntity"),rW(nn,R,"ytMainChannelEntity"),hO(nn,"mainPlaylistEntity"),hO(nn,"mainDownloadsListEntity"),hO(nn,"ytMainChannelEntity"),hO(nn,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:L=Yy.V;M=g.H(L);b=M.next().value;N=M.next().value;Z=M.next().value;F=M.next().value;Q=M.next().value;w=M.next().value;C=b;x=N;q=Z;y=F;e=Q;G=w;if(!C&&!x){Yy.qh(3);break}B=C?gcd(C):[];if(!x){u=[];Yy.qh(4);break}return g.t(Yy,Q3X(x,e),5);case 5:u=Yy.V;case 4:return E=u,g.t(Yy,Ju(B.concat(E)),3);case 3:I=[];AY=new Map;if(!C){Yy.qh(7);break}return g.t(Yy,wGX(C,q,y),8);case 8:I=Yy.V;O5=g.H(I);for(X=O5.next();!X.done;X=O5.next())S=X.value,AY.set(S,{videoId:S,playlistId:m,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.t(Yy,iB(c,{mode:"readonly",k$:!0},function(nn){return g.dx.all([hO(nn,"transfer"),hO(nn,"videoDownloadContextEntity")])}),9);
case 9:P=Yy.V;V=g.H(P);Y=V.next().value;m4=V.next().value;xh=Y;Wr=m4;er=g.H(xh);for(U5=er.next();!U5.done;U5=er.next())pd=U5.value,wi=g.Ng(pd.key).entityId,(T=AY.get(wi))&&pd&&(T.cotn=pd.cotn);z=g.H(Wr);for(d=z.next();!d.done;d=z.next())K=d.value,a=g.Ng(K.key).entityId,(c$=AY.get(a))&&K&&(c$.offlineModeType=K.offlineModeType);case 7:RU=[];LN=g.H(G);for(v=LN.next();!v.done;v=LN.next())NK=v.value,gE=g.Ng(NK.key).entityId,bm=wP(NK),gE!==m&&bm.rootActionId!==m||oj(W,NK.actionProto)||RU.push(NK.key);DQ=
g.Zk(m,"mainPlaylistEntity");return g.t(Yy,iB(c,{mode:"readwrite",k$:!0},function(nn){var $S=RU.map(function(D5){return EZ(nn,D5)});
$S.push(EZ(nn,DQ,{a6:!0}));return g.dx.all($S)}),10);
case 10:if(!C){Yy.qh(0);break}I.reverse();if(!I){Yy.qh(0);break}NQ=g.H(I);hc=NQ.next();case 13:if(hc.done){Yy.qh(0);break}F0=hc.value;return g.t(Yy,HF(F0,c,W,A,AY.get(F0)),14);case 14:hc=NQ.next(),Yy.qh(13)}})},Vfc=function(m,c,W,A){var p,R,L,M,b,N,Z,F,Q;
return g.D(function(w){if(w.j==1)return p=g.Zk("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),R=new Map,g.t(w,iB(m,{mode:"readwrite",k$:!0},function(C){var x=hO(C,"transfer"),q=hO(C,"offlineOrchestrationActionWrapperEntity"),y=hO(C,"videoDownloadContextEntity"),e=rW(C,p,"mainDownloadsListEntity");return g.dx.all([x,q,y,e]).then(function(G){G=g.H(G);var B=G.next().value;var u=G.next().value;var E=G.next().value;var I=G.next().value;G=JUa.map(function(O5){return gMv(C,O5)});
u=g.H(u);for(var AY=u.next();!AY.done;AY=u.next())AY=AY.value,oj(c,AY.actionProto)||G.push(EZ(C,AY.key,{a6:!0}));I&&(I.downloads=[],G.push(S3(C,I,"mainDownloadsListEntity")));if(E)for(E=g.H(E),I=E.next();!I.done;I=E.next())I=I.value,u=g.Ng(I.key).entityId,u=g.Zk(u,"transfer"),R.set(u,I.offlineModeType);return g.dx.all(G).then(function(){return B})})}),2);
L=w.V;M=g.H(L);for(b=M.next();!b.done;b=M.next())N=b.value,FW(N,R.get(N.key)),Z=g.Ng(N.key).entityId,F={videoId:Z,offlineDeleteReason:A,cotn:N.cotn,offlineModeType:R.get(N.key)},L0(F),Q=g.Zk(Z,"mainVideoEntity"),p0(W,{entityKey:Q,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.t(w,F5c(),0)})},gcd=function(m,c){var W=[];
if(m.thumbnailStyleData){m=g.H(m.thumbnailStyleData);for(var A=m.next();!A.done;A=m.next()){var p=void 0,R=void 0,L=void 0;W=W.concat(Qj((p=A.value)==null?void 0:(R=p.value)==null?void 0:(L=R.collageThumbnail)==null?void 0:L.coverThumbnail))}}c=Qj(c);return W.concat(c)},wGX=function(m,c,W){var A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5;
return g.D(function(X){A=[];p=new Set;if(W.length)for(R=g.H(W),L=R.next();!L.done;L=R.next())if(M=L.value,b=void 0,(b=M.downloads)==null?0:b.length)for(N=g.H(M.downloads),Z=N.next();!Z.done;Z=N.next())F=Z.value,F.videoItem&&(Q=g.Ng(F.videoItem).entityId,p.add(Q));if(m.videos){w=g.H(m.videos);for(C=w.next();!C.done;C=w.next())x=C.value,q=JSON.parse(g.Ng(x).entityId),q.videoId&&!p.has(q.videoId)&&A.push(q.videoId);y=g.H(c);for(e=y.next();!e.done;e=y.next())if(G=e.value,G.key!==m.key&&(B=G.videos))for(u=
g.H(B),E=u.next();!E.done;E=u.next())I=E.value,AY=JSON.parse(g.Ng(I).entityId),AY.videoId&&(O5=A.indexOf(AY.videoId),O5!==-1&&A.splice(O5,1))}return X.return(A)})},Q3X=function(m,c){var W,A,p,R,L,M,b,N;
return g.D(function(Z){W=Qj(m.avatar);A=g.H(c);for(p=A.next();!p.done;p=A.next())if(R=p.value,R.id!==m.id)for(L=g.H(Qj(R.avatar)),M=L.next();!M.done;M=L.next())b=M.value,N=W.indexOf(b),N!==-1&&W.splice(N,1);return Z.return(W)})},Ho4=function(m){var c;
return g.D(function(W){c=g.h(m.frameworkUpdates,xO);return m.frameworkUpdates&&c?g.t(W,dGd(c),0):W.return()})},lir=function(m){var c;
if((c=m.onResponseReceivedActions)!=null&&c.length){var W;m=(W=g.h(g.h(m.onResponseReceivedActions[0],xR4),g.ShS))==null?void 0:W.actions;if(m!=null&&m.length)return m}},qgh=function(m){var c,W,A;
return g.D(function(p){if(p.j==1)return m?g.t(p,Pu(m,g.GT,"mainDownloadsListEntity"),2):p.return([]);c=p.V;return((W=c)==null?0:(A=W.downloads)==null?0:A.length)?p.return(c.downloads.map(function(R){var L;return(L=R.videoItem)!=null?L:""})):p.return([])})},yU9=function(m,c){var W;
return g.D(function(A){return A.j==1?g.t(A,T_H(m,c),2):(W=A.V)?g.t(A,iB(m,{mode:"readwrite",k$:!0},function(p){var R=[S3(p,W.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];W.mainDownloadsListEntity&&R.push(S3(p,W.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.dx.all(R)}),0):A.qh(0)})},T_H=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G;
return g.D(function(B){if(B.j==1)return W=g.Zk("main_downloads_library_id","mainDownloadsLibraryEntity"),A=g.Zk("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.t(B,iB(m,{mode:"readonly",k$:!0},function(u){return g.dx.all([rW(u,W,"mainDownloadsLibraryEntity"),rW(u,A,"mainDownloadsListEntity")])}),2);
p=B.V;R=g.H(p);L=R.next().value;M=R.next().value;b=L;N=M;b||(b={id:W});Z=g.H(c);for(F=Z.next();!F.done;F=Z.next())if(Q=F.value,Q===g.GT){if(b.smartDownloadsList)return B.return();b.smartDownloadsList=Q}else if(w=g.Ng(Q).entityType,C={},w==="mainPlaylistEntity"?C.playlistItem=Q:w==="mainVideoEntity"&&(C.videoItem=Q),!g.Dd(C)){x=void 0;if((x=N)==null?0:x.downloads){q=!1;y=g.H(N.downloads);for(e=y.next();!e.done;e=y.next())if(G=e.value,G.playlistItem===Q||G.videoItem===Q){q=!0;break}q||N.downloads.push(C)}else N=
{id:A,downloads:[C]};b.downloadsList=A}return B.return({mainDownloadsLibraryEntity:b,mainDownloadsListEntity:N})})},z6h=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q;
return g.D(function(y){if(y.j==1)return W=g.Zk("main_downloads_library_id","mainDownloadsLibraryEntity"),A=g.Zk("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.t(y,iB(m,{mode:"readonly",k$:!0},function(e){return g.dx.all([rW(e,W,"mainDownloadsLibraryEntity"),rW(e,A,"mainDownloadsListEntity"),rW(e,g.GT,"mainDownloadsListEntity")])}),2);
p=y.V;R=g.H(p);L=R.next().value;M=R.next().value;b=R.next().value;N=L;Z=M;F=b;if(!N)return y.qh(0);if(c===g.GT&&((Q=F)==null?0:Q.downloads))F.downloads=[];else if((w=Z)==null?0:w.downloads)for(C=g.Ng(c).entityType,x=0;x<Z.downloads.length;x++)if(q=Z.downloads[x],C==="mainVideoEntity"&&q.videoItem===c){Z.downloads.splice(x,1);break}else if(C==="mainPlaylistEntity"&&q.playlistItem===c){Z.downloads.splice(x,1);break}return g.t(y,iB(m,{mode:"readwrite",k$:!0},function(e){var G=[S3(e,N,"mainDownloadsLibraryEntity")];
Z&&G.push(S3(e,Z,"mainDownloadsListEntity"));F&&G.push(S3(e,F,"mainDownloadsListEntity"));return g.dx.all(G)}),0)})},l_=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q;
return g.D(function(w){if(w.j==1)return W=g.Zk(c,"transfer"),A=g.Zk(c,"videoDownloadContextEntity"),g.t(w,iB(m,{mode:"readonly",k$:!0},function(C){return g.dx.all([rW(C,W,"transfer"),rW(C,A,"videoDownloadContextEntity")])}),2);
p=w.V;R=g.H(p);L=R.next().value;M=R.next().value;b=L;N=M;Q={videoId:c,cotn:(Z=b)==null?void 0:Z.cotn,offlineModeType:(F=N)==null?void 0:F.offlineModeType};return w.return(Q)})},qu=function(m,c,W,A,p){var R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY;
return g.D(function(O5){switch(O5.j){case 1:return R=g.Zk(m,"musicTrack"),L=g.Zk(m,"transfer"),g.t(O5,iB(c,{mode:"readonly",k$:!0},function(X){return g.dx.all([rW(X,R,"musicTrack"),rW(X,L,"transfer"),hO(X,"musicTrack"),hO(X,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:M=O5.V;b=g.H(M);N=b.next().value;Z=b.next().value;F=b.next().value;Q=b.next().value;w=N;C=Z;x=F;q=Q;if(!w){O5.qh(3);break}return g.t(O5,e6Q(w,x),4);case 4:return y=O5.V,g.t(O5,Ju(y),3);case 3:e=[];G=g.H(q);for(B=G.next();!B.done;B=G.next())u=B.value,E=g.Ng(u.key).entityId,I=wP(u),AY=g.Ng(I.action.entityKey).entityId,E!==m&&AY!==m||oj(W,u.actionProto)||e.push(u.key);return g.t(O5,iB(c,{mode:"readwrite",k$:!0},function(X){var S=e.map(function(P){return EZ(X,P)});
S.push(EZ(X,R,{a6:!0}));return g.dx.all(S)}),6);
case 6:FW(C),p&&L0(p),p0(A,{entityKey:R,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.CN(O5)}})},Tv=function(m,c,W,A,p){var R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5,X,S,P,V,Y,m4,xh,Wr,er,U5,pd,wi,T,z,d;
return g.D(function(K){switch(K.j){case 1:return R=g.Zk(m,c),L=g.Zk("music_downloads_library_id","musicDownloadsLibraryEntity"),g.t(K,iB(W,{mode:"readonly",k$:!0},function(a){return g.dx.all([rW(a,R,c),rW(a,L,"musicDownloadsLibraryEntity"),hO(a,c),hO(a,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:M=K.V;b=g.H(M);N=b.next().value;Z=b.next().value;F=b.next().value;Q=b.next().value;w=N;C=Z;x=F;q=Q;if(!w){K.qh(3);break}return g.t(K,e6Q(w,x),4);case 4:return y=K.V,g.t(K,Ju(y),3);case 3:e=[];G=new Map;if(!w){K.qh(6);break}return g.t(K,dR4(w,x,C),7);case 7:e=K.V;B=g.H(e);for(u=B.next();!u.done;u=B.next())E=u.value,I=g.Ng(E).entityId,G.set(I,{videoId:I,playlistId:m,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.t(K,UZ(W,"transfer"),8);case 8:for(AY=K.V,O5=g.H(AY),
X=O5.next();!X.done;X=O5.next())S=X.value,P=g.Ng(S.key).entityId,(V=G.get(P))&&S&&(V.cotn=S.cotn);case 6:Y=[];m4=g.H(q);for(xh=m4.next();!xh.done;xh=m4.next())Wr=xh.value,er=g.Ng(Wr.key).entityId,U5=wP(Wr),er!==m&&U5.rootActionId!==m||oj(A,Wr.actionProto)||Y.push(Wr.key);pd=g.Zk(m,c);return g.t(K,iB(W,{mode:"readwrite",k$:!0},function(a){var c$=Y.map(function(RU){return EZ(a,RU)});
c$.push(EZ(a,pd,{a6:!0}));return g.dx.all(c$)}),9);
case 9:if(!w){K.qh(0);break}e.reverse();if(!e.length){K.qh(0);break}wi=g.H(e);T=wi.next();case 12:if(T.done){K.qh(0);break}z=T.value;d=g.Ng(z).entityId;if(!d){K.qh(13);break}return g.t(K,qu(d,W,A,p,G.get(d)),13);case 13:T=wi.next(),K.qh(12)}})},yj=function(m,c,W){var A,p,R,L,M,b,N;
return g.D(function(Z){if(Z.j==1)return g.t(Z,iB(m,{mode:"readwrite",k$:!0},function(F){var Q=hO(F,"transfer"),w=hO(F,"offlineOrchestrationActionWrapperEntity");return g.dx.all([Q,w]).then(function(C){C=g.H(C);var x=C.next().value;var q=C.next().value;C=tfQ.map(function(B){return gMv(F,B)});
q=g.H(q);for(var y=q.next();!y.done;y=q.next()){y=y.value;var e=g.Ng(y.actionProto.entityKey).entityType==="musicTrack",G=y.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";oj(c,y.actionProto)||e&&(!e||G)||C.push(EZ(F,y.key,{a6:!0}))}return g.dx.all(C).then(function(){return x})})}),2);
A=Z.V;p=g.H(A);for(R=p.next();!R.done;R=p.next())L=R.value,FW(L),M=g.Ng(L.key).entityId,b={videoId:M,offlineDeleteReason:void 0,cotn:L.cotn},L0(b),N=g.Zk(M,"musicTrack"),p0(W,{entityKey:N,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.t(Z,F5c(),0)})},GZv=function(m){for(var c,W=g.H(m.additionalMetadatas),A=W.next();!A.done;A=W.next())A=A.value,A.offlineMusicVideoData&&(c=A.offlineMusicVideoData);
var p,R,L,M,b;return{id:g.Zk(m.videoId,"musicTrack"),videoId:m.videoId,title:m.title,thumbnailDetails:m.thumbnail,lengthMs:String(Number(m.lengthSeconds)*1E3),albumTitle:(p=c)==null?void 0:p.releaseTitle,musicVideoType:(R=c)==null?void 0:R.musicVideoType,contentRating:{explicitType:(L=c)==null?void 0:L.explicitType},artistNames:((M=c)==null?void 0:M.byline)||((b=c)==null?void 0:b.channelName),downloadMetadata:g.Zk(m.videoId,"musicTrackDownloadMetadataEntity")}},dR4=function(m,c,W){var A,p,R,L,M,b,
N,Z,F,Q,w,C,x,q,y,e,G,B;
return g.D(function(u){A=[];p=new Set;if((R=W)==null?0:(L=R.downloadedTracks)==null?0:L.length)for(M=g.H(W.downloadedTracks),b=M.next();!b.done;b=M.next())N=b.value,p.add(N);if(m.tracks){Z=g.H(m.tracks);for(F=Z.next();!F.done;F=Z.next())Q=F.value,p.has(Q)||A.push(Q);w=g.H(c);for(C=w.next();!C.done;C=w.next())if(x=C.value,x.id!==m.id&&(q=x.tracks))for(y=g.H(q),e=y.next();!e.done;e=y.next())G=e.value,B=A.indexOf(G),B!==-1&&A.splice(B,1)}return u.return(A)})},e6Q=function(m,c){var W,A,p,R,L,M,b,N;
return g.D(function(Z){W=Qj(m.thumbnailDetails);A=g.H(c);for(p=A.next();!p.done;p=A.next())if(R=p.value,R.id!==m.id)for(L=g.H(Qj(R.thumbnailDetails)),M=L.next();!M.done;M=L.next())b=M.value,N=W.indexOf(b),N!==-1&&W.splice(N,1);return Z.return(W)})},DRr=function(m,c){var W,A,p,R,L,M,b,N,Z;
return g.D(function(F){if(F.j==1)return W=g.Zk("music_downloads_library_id","musicDownloadsLibraryEntity"),g.t(F,Pu(m,W,"musicDownloadsLibraryEntity"),2);(A=F.V)||(A={id:W});p=g.Ng(c).entityType;p==="musicTrack"?(R=A.downloadedTracks)!=null&&R.includes(c)||(A.downloadedTracks=((L=A.downloadedTracks)!=null?L:[]).concat(c)):p==="musicPlaylist"?(M=A.downloadedPlaylists)!=null&&M.includes(c)||(A.downloadedPlaylists=((b=A.downloadedPlaylists)!=null?b:[]).concat(c)):p!=="musicAlbumRelease"||(N=A.downloadedAlbumReleases)!=
null&&N.includes(c)||(A.downloadedAlbumReleases=((Z=A.downloadedAlbumReleases)!=null?Z:[]).concat(c));return g.t(F,Ip(m,A,"musicDownloadsLibraryEntity"),0)})},K5S=function(m,c){var W,A,p,R,L,M,b;
return g.D(function(N){if(N.j==1)return W=g.Zk("music_downloads_library_id","musicDownloadsLibraryEntity"),g.t(N,Pu(m,W,"musicDownloadsLibraryEntity"),2);A=N.V;if(!A)return N.qh(0);p=g.Ng(c).entityType;p==="musicTrack"?R=A.downloadedTracks:p==="musicPlaylist"&&(R=A.downloadedPlaylists);if((L=R)==null?0:L.length)for(M=0;M<R.length;M++)if(b=R[M],b===c){R.splice(M,1);break}return g.t(N,Ip(m,A,"musicDownloadsLibraryEntity"),0)})},B_H=function(m){var c=m.videos;
m=[];var W=[];if(c){c=g.H(c);for(var A=c.next();!A.done;A=c.next()){var p=A.value.offlineVideoData.videoId;A=g.Zk(p,"musicTrack");p=g.Zk(p,"musicTrackDownloadMetadataEntity");m.push(A);W.push(p)}}return{mq:m,O3:W}},zv=function(m,c,W){c={track:GZv(c)};
W&&(c.playlistId=W);if(m=g.h(m.actionMetadata,vc4))c.maximumDownloadQuality=m.maximumDownloadQuality;return{musicTrackEntityActionMetadata:c}},aia=function(m){var c,W,A,p,R,L,M,b;
return g.D(function(N){switch(N.j){case 1:return c=g.$I(),W=aPc(m),A=g.gl(j3i),g.JY(N,2),R={K5:!0},g.t(N,g.Xk(c,W,A,void 0,R),4);case 4:p=N.V;g.H$(N,3);break;case 2:L=g.lm(N);if(L instanceof g.O4)throw M="GetOffline network manager error: "+L.message,WF(M,L),Error(M);WF("GetOffline fetch request error",L);throw Error("GetOffline fetch request error");case 3:b=e6(p);if(!p)throw WF("Network request failed"),Error("Network request failed");if(b!==void 0)dP(b);else if(!p.videos||!p.videos.length)throw WF("No data"),
Error("No data");return N.return(p.videos.map(function(Z){return Z.offlineVideoData}))}})},uN9=function(m){var c,W,A,p,R,L,M,b;
return g.D(function(N){switch(N.j){case 1:return c=g.$I(),W=uSd(m),A=g.gl(j3i),g.JY(N,2),R={K5:!0},g.t(N,g.Xk(c,W,A,void 0,R),4);case 4:p=N.V;g.H$(N,3);break;case 2:L=g.lm(N);if(L instanceof g.O4)throw M="GetOffline network manager error for playlist: "+L.message,WF(M,L),Error(M);WF("GetOffline fetch request error for playlist",L);throw Error("GetOffline fetch request error for playlist");case 3:b=e6(p);if(!p)throw WF("Network request failed for playlist"),Error("Network request failed for playlist");
if(b!==void 0)dP(b,"playlist");else if(!p.playlists||!p.playlists.length)throw WF("No data for playlist"),Error("No data for playlist");return N.return(p.playlists.map(function(Z){return Z.offlinePlaylistData}))}})},rUv=function(m,c,W,A){var p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5,X,S,P,V,Y,m4,xh,Wr;
return g.D(function(er){switch(er.j){case 1:return g.t(er,ku(),2);case 2:p=er.V;if(!p)return er.return([]);R=[];if((L=A)==null?0:L.length){R=A;er.qh(3);break}return g.t(er,UZ(p,"mainPlaylistEntity"),4);case 4:R=er.V;case 3:if(!R.length)return er.return([]);M=[];b=Date.now()/1E3;N=g.H(R);Z=N.next();case 5:if(Z.done)return M.length?g.t(er,nc4(M),10):er.return([]);F=Z.value;if(!F.downloadState){Q=void 0;er.qh(8);break}return g.t(er,Pu(p,F.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:Q=
er.V;case 8:w=Q;C=void 0;q=(x=(C=F)==null?void 0:C.entityMetadata)&&x.nextAutoRefreshIntervalSeconds?Number(x.nextAutoRefreshIntervalSeconds):NaN;y=Number.isNaN(q)?m:q;G=e=void 0;B=((e=w)==null?0:e.lastSyncedTimestampMillis)?Number((G=w)==null?void 0:G.lastSyncedTimestampMillis)/1E3:0;E=u=void 0;I=((u=w)==null?0:u.addedTimestampMillis)?Number((E=w)==null?void 0:E.addedTimestampMillis)/1E3:0;if(W||!x||B+y<=b){AY=[];O5=void 0;if((O5=F.videos)==null?0:O5.length)for(X=g.H(F.videos),S=X.next();!S.done;S=
X.next())P=S.value,V=JSON.parse(g.Ng(P).entityId),V.videoId&&AY.push(V.videoId);Y="0";x&&(m4=void 0,Y=String(Number((m4=x.offlineLastModifiedTimestampSeconds)!=null?m4:0).toFixed()));xh={playlistId:F.playlistId,videoIds:AY,offlineLastModifiedTimestamp:Y,autoSync:c,offlineDateAddedTimestamp:String(I.toFixed())};M.push(xh)}Z=N.next();er.qh(5);break;case 10:return Wr=er.V,er.return(Wr)}})},h6v=function(){var m,c,W,A,p;
return g.D(function(R){if(R.j==1)return g.t(R,ku(),2);if(R.j!=3)return(m=R.V)?g.t(R,UZ(m,"refresh"),3):R.return(!1);c=R.V;if((W=c[0])==null||!W.refreshTime)return R.return(!1);A=Number(c[0].refreshTime);p=Date.now()/1E3;return R.return(isFinite(A)&&p>=A)})},Sgh=function(m,c){var W,A,p;
return g.D(function(R){switch(R.j){case 1:return g.JY(R,2),g.t(R,s3d(m,c),4);case 4:return A=R.V,g.t(R,Ho4(A),5);case 5:W=lir(A);g.H$(R,3);break;case 2:p=g.lm(R),WF("getAndProcessSmartDownloadsResponse request or processing error",p);case 3:return R.return(W)}})},Eca=function(m,c,W,A){var p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5,X,S,P,V,Y,m4,xh,Wr;
return g.D(function(er){switch(er.j){case 1:return g.t(er,ku(),2);case 2:p=er.V;if(!p)return er.return([]);R=[];if((L=A)==null?0:L.length){R=A;er.qh(3);break}return g.t(er,UZ(p,"musicPlaylist"),4);case 4:R=er.V;case 3:if(!R.length)return er.return([]);M=[];b=Date.now()/1E3;N=g.H(R);Z=N.next();case 5:if(Z.done)return M.length?g.t(er,nc4(M),10):er.return([]);F=Z.value;Q=void 0;C=(w=(Q=F)==null?void 0:Q.entityMetadata)&&w.nextAutoRefreshIntervalSeconds?Number(w.nextAutoRefreshIntervalSeconds):NaN;x=
Number.isNaN(C)?m:C;y=q=0;e="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!F.downloadMetadata){er.qh(8);break}return g.t(er,Pu(p,F.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:G=er.V,u=B=void 0,q=Number((u=(B=G)==null?void 0:B.addedTimestampMillis)!=null?u:"0")/1E3,I=E=void 0,y=Number((I=(E=G)==null?void 0:E.lastModifiedTimestampMillis)!=null?I:"0")/1E3,O5=AY=void 0,e=(O5=(AY=G)==null?void 0:AY.syncState)!=null?O5:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:X=void 0;if(W||e!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!w||Number((X=w.lastSyncedTimestampSeconds)!=null?X:0)+x<=b){S=[];P=void 0;if((P=F.tracks)==null?0:P.length)for(V=g.H(F.tracks),Y=V.next();!Y.done;Y=V.next())m4=Y.value,S.push(g.Ng(m4).entityId);xh={playlistId:F.playlistId,videoIds:S,offlineLastModifiedTimestamp:String(y.toFixed()),autoSync:c,offlineDateAddedTimestamp:String(q.toFixed())};M.push(xh)}Z=N.next();er.qh(5);break;case 10:return Wr=er.V,er.return(Wr)}})},s3d=function(m,c){var W,A,p,R,L,M,b,N,Z,F;
return g.D(function(Q){switch(Q.j){case 1:return W=g.$I(),g.t(Q,ku(),2);case 2:A=Q.V;if(!A){Q.qh(3);break}return g.t(Q,YOv(A),4);case 4:p=Q.V;case 3:var w=p;R={context:g.o2(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:m},offlineClientState:w,clientStateRequestData:{preferredFormatType:c}}}};L=g.gl(Yg4);g.JY(Q,5);b={K5:!0};return g.t(Q,g.Xk(W,R,L,void 0,b),7);case 7:M=Q.V;g.H$(Q,6);break;case 5:N=g.lm(Q);if(N instanceof g.O4)throw Z=
"DPS network manager error for smart downloads: "+N.message,WF(Z,N),Error(Z);WF("DPS fetch request error for smart downloads",N);throw Error("DPS fetch request error for smart downloads");case 6:F=e6(M);if(M)F!==void 0&&dP(F,"smart downloads");else throw WF("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return Q.return(M)}})},ioa=function(m,c){var W,A,p,R,L,M,b,N;
return g.D(function(Z){switch(Z.j){case 1:return W=g.$I(),A={context:g.o2(),videoPlaybackPositionEntities:m,lastSyncTimestampUsec:c},p=g.gl(fiv),g.JY(Z,2),L={K5:!0},g.t(Z,g.Xk(W,A,p,void 0,L),4);case 4:R=Z.V;g.H$(Z,3);break;case 2:M=g.lm(Z);if(M instanceof g.O4)throw b="VPPS network manager error: "+M.message,WF(b,M),Error(b);WF("VPPS fetch request error",M);throw Error("VPPS fetch request error");case 3:N=e6(R);if(R)N!==void 0&&dP(N,"position sync");else throw WF("Network request failed for position sync"),
Error("Network request failed for position sync");return Z.return(R)}})},PoG=function(m,c,W){var A,p,R,L,M,b,N,Z;
return g.D(function(F){switch(F.j){case 1:A=g.$I();var Q=W.refreshData,w=W.isEnqueuedForExpiredStreamUrlRefetch,C=W.BC,x=W.offlineSourceData,q=W.mediaCapabilities,y={entityKey:m};Q&&(y.refreshData=Q);w&&(y.isExpiredStreamUrlRefetch=w);C&&(y.downloadParameters=C);x&&(y.offlineSourceData=x);Q={context:g.U2(c),signatureTimestamp:20110,videos:[y]};q&&(Q.mediaCapabilities=q);p=Q;R=g.gl(Ii9);g.JY(F,2);M={K5:!0};return g.t(F,g.Xk(A,p,R,void 0,M),4);case 4:L=F.V;g.H$(F,3);break;case 2:b=g.lm(F);if(b instanceof
g.O4)throw N="GetPDE network manager error: "+b.message,WF(N,b),Error(N);WF("GetPDE fetch request error",b);throw Error("GetPDE fetch request error");case 3:Z=e6(L);if(L)Z!==void 0&&dP(Z,"PDE");else throw WF("Network request failed for PDE"),Error("Network request failed for PDE");return F.return(L)}})},e6=function(m){var c;
return(c=m.errorMetadata)==null?void 0:c.status},dP=function(m,c){c=c?" for "+c:"";
if(m===0)throw m="Empty response body"+c,WF(m),Error(m);m="Response with error"+c;WF(m);throw Error(m);},nc4=function(m){var c,W,A,p,R,L,M,b;
return g.D(function(N){switch(N.j){case 1:return c=g.$I(),W=nMh(m),A=g.gl(URr),g.JY(N,2),R={K5:!0},g.t(N,g.Xk(c,W,A,void 0,R),4);case 4:p=N.V;g.H$(N,3);break;case 2:L=g.lm(N);if(L instanceof g.O4)throw M="offlinePlaylistSyncCheck network manager error: "+L.message,WF(M,L),Error(M);WF("offlinePlaylistSyncCheck fetch request error",L);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:b=e6(p);if(!p)throw WF("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(b!==void 0)dP(b,"playlist sync");else if(!p.offlinePlaylistSyncCheckDatas||!p.offlinePlaylistSyncCheckDatas.length)throw WF("No data for playlist sync"),Error("No data for playlist sync");return N.return(p.offlinePlaylistSyncCheckDatas.map(function(Z){return Z.offlinePlaylistSyncCheckData}))}})},tu=function(m){this.j=m},kZ4=function(m,c){var W,A,p,R,L,M;
return g.D(function(b){switch(b.j){case 1:W=new Map,A=g.H(c),p=A.next();case 2:if(p.done){b.qh(4);break}R=p.value;L=W;M=L.set;return g.t(b,m.V(R),5);case 5:M.call(L,R,b.V);p=A.next();b.qh(2);break;case 4:return b.return(W)}})},Gv=function(m,c,W,A,p,R){c=g.Zk(c,W);
A=Object.assign({},R,{priority:A,retryScheduleIntervalsInSeconds:p});return{actionType:m,entityKey:c,actionMetadata:A}},Dg=function(m,c,W,A,p,R){this.status=m;
this.j=c;this.L=W;this.V=A;this.K=p;this.downloadState=R},XGS=function(m,c,W){this.j=m;
this.Ag=c;this.K=W},Wir=function(m,c){var W,A,p,R,L,M,b,N,Z;
return g.D(function(F){switch(F.j){case 1:return W=c.entityKey,p=(A=g.h(c.actionMetadata,K0))==null?void 0:A.isEnqueuedForExpiredStreamUrlRefetch,g.JY(F,2),R=void 0,g.t(F,mCQ(m,c),4);case 4:R=F.V;g.JY(F,5);var Q=(Q=g.h(c.actionMetadata,K0))?{maximumDownloadQuality:Q.maximumDownloadQuality}:void 0;return g.t(F,PoG(W,m.Ag,{isEnqueuedForExpiredStreamUrlRefetch:p,BC:Q,offlineSourceData:R}),7);case 7:L=F.V;g.H$(F,6,2);break;case 5:return g.lm(F,2),M=Mu(c)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",WF("PDE handleAdd error"),F.return(BF(c,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",M,"DOWNLOAD_STATE_FAILED"));case 6:return g.t(F,cl4(m,L,c),8);case 8:return F.return(BF(c,!0,L.orchestrationActions));case 2:return b=g.lm(F),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.xK&&b.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),WF("PDE handleAdd error"),F.return(BF(c,!1,void 0,N,Z,"DOWNLOAD_STATE_FAILED"))}})},RCS=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5;
return g.D(function(X){switch(X.j){case 1:return W=c.entityKey,A=g.Ng(W).entityId,g.t(X,iB(m.j,{mode:"readonly",k$:!0},function(S){var P=rW(S,W,"playbackData"),V=rW(S,g.Zk(A,"offlineVideoPolicy"),"offlineVideoPolicy");S=rW(S,g.Zk(A,"transfer"),"transfer");return g.dx.all([P,V,S])}),2);
case 2:p=X.V;R=g.H(p);L=R.next().value;M=R.next().value;b=R.next().value;N=L;Z=M;F=b;if(!N||!Z)return X.return(BF(c,!0));Q=[];x=((C=N)==null?0:C.playerResponseJson)?JSON.parse(N.playerResponseJson):null;if(!(F&&x&&m.Ag.G("html5_refresh_deprecated_downloads"))){X.qh(3);break}w=Alr(m,x,F);return g.t(X,pgH(m,F),4);case 4:Q=X.V;case 3:q={lastPlayerResponseTimestampSeconds:N.playerResponseTimestamp,offlineToken:Z.offlineToken,formatIds:Q};y={};if((e=F)==null?0:e.maximumDownloadQuality)y.maximumDownloadQuality=
F.maximumDownloadQuality;g.JY(X,5);G=void 0;return g.t(X,mCQ(m,c),7);case 7:return G=X.V,g.JY(X,8),g.t(X,PoG(W,m.Ag,{refreshData:q,BC:y,offlineSourceData:G,mediaCapabilities:w}),10);case 10:B=X.V;g.H$(X,9,5);break;case 8:return g.lm(X,5),u=Mu(c)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",WF("PDE handleRefresh error"),X.return(BF(c,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",u,"DOWNLOAD_STATE_FAILED"));
case 9:return g.t(X,cl4(m,B,c),11);case 11:return X.return(BF(c,!0,B.orchestrationActions));case 5:return E=g.lm(X),I="PDE handleRefresh error",E instanceof Error&&(I="PDE handleRefresh error: "+E.message),AY="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.xK&&E.type==="QUOTA_EXCEEDED"&&(AY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),WF(I),X.return(BF(c,
!1,void 0,AY,O5,"DOWNLOAD_STATE_FAILED"))}})},mCQ=function(m,c){var W,A,p,R;
return g.D(function(L){if(L.j==1)return W=g.Ng(c.entityKey).entityId,A=g.Zk(W,"videoDownloadContextEntity"),g.t(L,Pu(m.j,A,"videoDownloadContextEntity"),2);p=L.V;return(R=p)!=null&&R.offlineModeType?L.return({offlineModeType:p.offlineModeType}):L.return(void 0)})},cl4=function(m,c,W){var A,p,R,L,M;
return g.D(function(b){if(b.j==1){if(!c.frameworkUpdates||!g.h(c.frameworkUpdates,xO))return b.return();if(!(g.h(c.frameworkUpdates,xO).mutations&&g.h(c.frameworkUpdates,xO).mutations.length>0&&g.h(c.frameworkUpdates,xO).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return b.qh(2);A=g.Ng(g.h(c.frameworkUpdates,xO).mutations[0].entityKey).entityId;return g.t(b,l_(m.j,A),3)}if(b.j!=2){p=b.V;R=g.h(W.actionMetadata,K0);if(M=(L=R)==null?void 0:L.playlistId)p.playlistId=M;p.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Er(m.Ag)?g.t(b,HF(A,m.j,W,m.K,p),2):g.hK(m.Ag)?g.t(b,qu(A,m.j,W,m.K),2):b.qh(2)}return g.t(b,dGd(g.h(c.frameworkUpdates,xO)),0)})},BF=function(m,c,W,A,p,R){return new Dg(c?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Mu(m),W,A,p,R)},Alr=function(m,c,W){c=ZoG(m.Ag,W.cotn,c);
W=g.c2(c);return g.tUb(c,W,m.Ag)},pgH=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q;
return g.D(function(w){if(w.j==1)return W=[],g.t(w,iB(m.j,{mode:"readonly",k$:!0},function(C){var x=[],q=c.offlineVideoStreams;if(q){q=g.H(q);for(var y=q.next();!y.done;y=q.next())x.push(rW(C,y.value,"offlineVideoStreams"))}return g.dx.all(x)}),2);
if(A=w.V)for(p=g.H(A),R=p.next();!R.done;R=p.next())if(L=R.value,M=void 0,(M=L)==null?0:M.streamsProgress)for(b=L.streamsProgress,N=0;N<b.length;N++)Z=b[N],F=JSON.parse(Z.formatStreamBytes),Q={itag:F.itag,lmt:F.lastModified,xtags:F.xtags},W.push(Q);return w.return(W)})},LiS=function(m,c){this.j=m;
this.Ag=c},ODv=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w;
return g.D(function(C){switch(C.j){case 1:return W=Mu(c),g.t(C,UZ(m.j,"videoPlaybackPositionEntity"),2);case 2:A=C.V;if(A.length===0)return C.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));g.JY(C,3);return g.t(C,ap.getInstance(),5);case 5:p=C.V;if(!p)throw Error("prefStorage is undefined");return g.t(C,p.get("psi"),6);case 6:return R=C.V,b=(M=(L=R)==null?void 0:L.UL)!=null?M:"0",g.t(C,ioa(A,b),7);case 7:return N=C.V,Z={isPaused:N.watchHistoryPaused,UL:N.syncTimestampUsec},g.t(C,p.set("psi",
Z),8);case 8:if(Z.isPaused){C.qh(9);break}F=g.h(N.frameworkUpdates,xO);if(!N.frameworkUpdates||!F){C.qh(9);break}return g.t(C,dGd(F),9);case 9:g.H$(C,4);break;case 3:return Q=g.lm(C),w="PPE handleRefresh error: "+(Q instanceof Error?Q.message:"unknown error"),WF(w),C.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return C.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
W))}})},bDH=function(m,c){var W,A,p,R,L,M,b,N;
return g.D(function(Z){switch(Z.j){case 1:return W=Mu(c),A=g.Ng(c.entityKey).entityId,g.JY(Z,2),g.t(Z,ap.getInstance(),4);case 4:p=Z.V;if(!p)throw Error("prefStorage is undefined");return g.t(Z,p.get("psi"),5);case 5:R=Z.V;L=g.h(c.actionMetadata,MX4);if(((M=R)==null?void 0:M.isPaused)!==!1||(b=L)==null||!b.lastPlaybackPositionSeconds){Z.qh(6);break}N={key:g.Zk(A,"videoPlaybackPositionEntity"),videoId:A,lastPlaybackPositionSeconds:L.lastPlaybackPositionSeconds};return g.t(Z,Ip(m.j,N,"videoPlaybackPositionEntity"),
6);case 6:g.H$(Z,3);break;case 2:return g.lm(Z),Z.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W))}})},$Cc=function(m,c){var W,A,p;
return g.D(function(R){switch(R.j){case 1:W=Mu(c);g.JY(R,2);A=g.Ng(c.entityKey).entityId;if(A==="!*$_ALL_ENTITIES_!*$")return g.t(R,qOQ(m.j),5);p=g.Zk(A,"videoPlaybackPositionEntity");return g.t(R,lPH(m.j,p),5);case 5:g.H$(R,3);break;case 2:return g.lm(R),R.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return R.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
W))}})},N6h=function(m,c){this.api=m;
this.j=c;this.logger=new g.kU("woffle");this.V=!1;this.Km={f$:this.f$};this.logger.debug("Initialized OfflineMediaManager")},ZDa=function(m){return g.D(function(c){return c.return(jT4(m))})},o44=function(m){var c;
return g.D(function(W){if(W.j==1)return g.t(W,g.PA7(m),2);c=W.V;return W.return(c.filter(function(A){return!!A.url}).map(function(A){return A.url}))})},vF=function(m,c){var W=g.lM(c);
if(W===1||W===0)return Promise.resolve();(W=Fi4(m,c))&&W.stopVideo();m.K=0;return ZDa(c)},j6=function(m,c,W,A){W=W===void 0?!1:W;
A=A===void 0?!0:A;var p=typeof c==="string"?c:c.videoDetails.videoId;g.lM(p)===2&&((c=Fi4(m,p))?c.stopVideo():m.logger.info(function(){return"Corresponding player for "+p+" not found. Pausing anyway"}),g.qU(p,2),m.K=2,W?QEh(m.j):A&&g44(m.j))},Fi4=function(m,c){var W;
return((W=m.player)==null?void 0:W.getVideoData().videoId)===c?m.player:null},wga=function(m,c,W){c.getPlayerResponse();
g.qU(c.videoId,2);m.K=2;m.V=!1;var A;(A=m.player)==null||A.dispose();m.player=m.api.tP(9,c);c={};m.player.Op((c.localmediachange=m.oJ,c.signatureexpired=m.Xn,c.statechange=m.MQ8,c),m);var p=m.f$(W);m.player.LZ(g.cI(p,p,!0,"m"),!1);m.logger.debug(function(){return"Starting headless playback with quality: "+p});
m.player.X1(!1)},Cbd=function(m,c){this.j=m;
this.Ag=c},VXh=function(m,c){var W,A;
return g.D(function(p){switch(p.j){case 1:return W=Mu(c),g.t(p,Pu(m.j,c.entityKey,"transfer"),2);case 2:if(A=p.V)return p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));g.JY(p,3);return g.t(p,JlH(m,c),5);case 5:g.H$(p,4);break;case 3:return g.lm(p),p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
W))}})},HDG=function(m,c){var W,A;
return g.D(function(p){switch(p.j){case 1:return W=Mu(c),g.t(p,Pu(m.j,c.entityKey,"transfer"),2);case 2:A=p.V;if(!A||A.transferState!=="TRANSFER_STATE_COMPLETE")return p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));g.JY(p,3);return g.t(p,JlH(m,c,!0),5);case 5:g.H$(p,4);break;case 3:return g.lm(p),p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W))}})},xCv=function(m,c){var W,A,p,R,L,M,b,N,Z,F;
return g.D(function(Q){switch(Q.j){case 1:return W=Mu(c),A=g.Ng(c.entityKey).entityId,g.t(Q,iB(m.j,{mode:"readonly",k$:!0},function(w){var C=rW(w,c.entityKey,"transfer");w=rW(w,g.Zk(A,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.dx.all([C,w])}),2);
case 2:p=Q.V;R=g.H(p);L=R.next().value;M=R.next().value;b=L;N=M;if(!b||b.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return Q.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));g.JY(Q,3);b.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.t(Q,Ip(m.j,b,"transfer"),5);case 5:Z=g.Ng(b.key).entityId;OU({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:Z,gr:b,offlineModeType:(F=N)==null?void 0:F.offlineModeType});g.H$(Q,
4);break;case 3:return g.lm(Q),Q.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Q.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W))}})},JlH=function(m,c,W){W=W===void 0?!1:W;
var A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y;return g.D(function(e){switch(e.j){case 1:return A=g.h(c.actionMetadata,lwr),p=g.Ng(c.entityKey).entityId,R=g.Zk(p,"downloadStatusEntity"),g.t(e,iB(m.j,{mode:"readonly",k$:!0},function(G){var B=rW(G,R,"downloadStatusEntity");G=rW(G,g.Zk(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.dx.all([B,G])}),2);
case 2:return L=e.V,M=g.H(L),b=M.next().value,N=M.next().value,Z=b,F=N,Q="TRANSFER_STATE_TRANSFER_IN_QUEUE",((w=Z)==null?void 0:w.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(Q="TRANSFER_STATE_PAUSED_BY_USER"),q={key:c.entityKey,transferState:Q,cotn:g.zf(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(C=A)==null?void 0:C.maximumDownloadQuality,preferredAudioTrack:(x=A)==null?void 0:x.preferredAudioTrack,transferRetryCount:0,isRefresh:W,hasLoggedFirstStarted:!1},g.t(e,iB(m.j,
{mode:"readwrite",k$:!0},function(G){var B=[];W&&B.push(EZ(G,g.Zk(p,"offlineVideoStreams")));B.push(S3(G,q,"transfer"));return g.dx.all(B)}),3);
case 3:if(!W){e.qh(4);break}return g.t(e,ZDa(p),4);case 4:OU({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:p,gr:q,offlineModeType:(y=F)==null?void 0:y.offlineModeType}),g.CN(e)}})},T6X=function(m,c,W,A){if(!m.action.entityKey)throw Error("entityKey is missing.");
var p=g.Ng(m.action.entityKey);p={entityType:p.kS,entityId:p.entityId,offlineOrchestrationActionType:m.action.actionType,orchestrationAction:{orchestrationActionId:m.actionId}};c&&(p.offlineOrchestrationActionResult=c.status,p.isRetryable=W?!1:c.j,c.K&&(p.offlineOrchestrationFailureReason=qFQ(c.K,p.isRetryable)));var R,L;if((R=m.action.actionMetadata)==null?0:(L=R.offlineLoggingData)==null?0:L.offlineModeType)p.offlineModeType=m.action.actionMetadata.offlineLoggingData.offlineModeType;A&&(p.additionalOrchestrationActions=
A.map(function(M){return{orchestrationActionId:M.actionId}}));
return p},qFQ=function(m,c){return m!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||c?m==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&c?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":m:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},ylc=function(m,c){var W={offlineOrchestrationContext:T6X(m)};
c=SOh(c,W);EMa(sT9(),c,m.rootActionId)},zCh=function(m,c,W,A){A=A===void 0?[]:A;
c={offlineOrchestrationContext:T6X(m,c,W,A)};c=SOh(3,c);EMa(sT9(),c,m.rootActionId)},eCS=function(){this.actions=[]},dCH=function(m,c){c=g.H(c);
for(var W=c.next();!W.done;W=c.next())W=W.value,ylc(W,1),m.actions.push(W);m.actions.sort(m.j)},tXS=function(m,c){if(c)for(var W=0;W<m.actions.length;W++)if(c==="!*$_ALL_ENTITIES_!*$"&&m.actions[W].actionId!==c||c!=="!*$_ALL_ENTITIES_!*$"&&m.actions[W].rootActionId===c&&m.actions[W].actionId!==c)m.actions.splice(W,1),W--},Gbc=function(m,c){m=g.H(m.actions);
for(var W=m.next();!W.done;W=m.next())if(W.value.actionId===c)return!0;return!1},aj=function(m,c,W,A,p){g.n.call(this);
var R=this;this.V=m;this.Kf=c;this.Vb=W;this.X=A;this.Ag=p;this.j=new eCS;this.B=new g.X1;this.K=new g.Rv(function(){R.retry()});
this.N=NaN;this.U=!1;this.Km={edm:function(){return R.j},
OY:function(){return R.B},
lG8:function(){return R.K},
retry:function(){return R.retry()}};
g.r(this,this.K);this.W=this.V.observe(this.Mh.bind(this))},B6G=function(m,c,W,A,p){var R;
return g.D(function(L){if(L.j==1)return R=new aj(m,c,W,A,p),g.t(L,DCG(R),2);Ki4(R);return L.return(R)})},Ki4=function(m){var c=m.j.actions[0];
return m.L?((c==null?void 0:c.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&m.L[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(m.U=!0),Promise.resolve()):v4v(m)},v4v=function(m){var c,W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y;
return g.D(function(e){switch(e.j){case 1:if(m.L)throw Error("Already processing an action");if(m.Bs())return e.return();c=m.j.actions.shift();pGX(m.Vb,!c);if(c===void 0)return e.return();c.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&c.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&tXS(m.j,c.actionId);W="";c.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&c.rootActionId===c.actionId&&(W=c.actionId);A=[c];m.L=A;if(p=m.Kf[c.entityType]){e.qh(2);break}m.L=
void 0;return g.t(e,v4v(m),3);case 3:return e.return();case 2:R=g.H(A);for(L=R.next();!L.done;L=R.next())M=L.value,ylc(M,2);g.JY(e,4,5);return g.t(e,kZ4(p,A.map(function(G){return G.action})),7);
case 7:b=e.V,N=g.H(A),Z=N.next();case 8:if(Z.done){e.qh(10);break}F=Z.value;Q=b.get(F.action);return g.t(e,jEd(m,F,Q),9);case 9:Z=N.next();e.qh(8);break;case 10:tXS(m.j,W);case 5:g.qK(e);m.L=void 0;g.Ts(e,6);break;case 4:return w=g.lm(e),WF("Orchestration error",w),g.JY(e,12),g.t(e,aw4(m,A),14);case 14:g.H$(e,5);break;case 12:C=g.lm(e);WF("Orchestration retry error",C);x=g.H(A);for(q=x.next();!q.done;q=x.next())y=q.value,y.retryScheduleIndex<3&&dCH(m.j,[y]);e.qh(5);break;case 6:return g.t(e,v4v(m),
0)}})},jEd=function(m,c,W){var A,p,R,L,M,b,N,Z,F,Q,w,C;
return g.D(function(x){switch(x.j){case 1:A=c.retryScheduleIndex+2===3;if(W.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){x.qh(2);break}if(W.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){x.qh(0);break}zCh(c,W,A);if(W.j&&c.retryScheduleIndex+1<3)return g.t(x,aw4(m,[c]),0);R=((p=W)==null?0:p.V)?W.V:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";L={entityKey:c.action.entityKey,failureReason:R};M=void 0;g.Er(m.Ag)?M="mainVideoDownloadStateEntity":g.hK(m.Ag)&&(M="musicTrackDownloadMetadataEntity");
if(!M||!W.downloadState){x.qh(7);break}b=g.Ng(c.action.entityKey).entityId;return g.t(x,Zg(b,M,m.V,W.downloadState),7);case 7:p0(m.X,L);if(W.downloadState==="DOWNLOAD_STATE_FAILED"&&m.Ag.G("html5_auto_retry_failed_pde_actions")){x.qh(0);break}WF("Orchestration result is not retryable, deleting action");return g.t(x,lPH(m.V,C0(c).key),0);case 2:N=void 0;try{N=(Z=W.L)==null?void 0:Z.map(function(q){return m.createAction(q,c)})}catch(q){return zCh(c,W,A),F={entityKey:c.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},p0(m.X,F),WF("Orchestration subactions creation error",q),x.return()}zCh(c,W,A,N);if(!N){x.qh(12);break}Q=N.map(function(q){return C0(q)});
w=0;case 13:if(!(w<N.length)||m.U){x.qh(15);break}return g.t(x,iB(m.V,{mode:"readwrite",k$:!0},function(q){var y=[];y.push(oMG(q,Q.slice(w,w+10),"offlineOrchestrationActionWrapperEntity"));return g.dx.all(y)}),16);
case 16:w+=10;x.qh(13);break;case 15:if(m.U)return m.U=!1,x.return();case 12:return C=C0(c),g.t(x,lPH(m.V,C.key),17);case 17:ylc(c,4),g.CN(x)}})},hCv=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w;
return g.D(function(C){W=[];A=Infinity;p=4E3;R=g.H(c);for(L=R.next();!L.done;L=R.next())M=L.value,b=Number(M.enqueueTimeSec),N=uEh(b),Z=M.retryScheduleIndex,F=Z!=null&&Z>0,N>0&&F?(A=Math.min(A,b),p=Math.min(N,p)):W.push(M);isFinite(A)&&(!m.K.isActive()||A<m.N)&&(m.N=A,m.K.start(p));m.B.P3()||(Q=W.length,W=W.filter(function(x){var q;x=((q=x.actionProto)==null?void 0:q.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!n4d.includes(x)}),w=W.length<Q,!m.K.isActive()&&w&&m.K.start(1));
W.length>0&&rlh(m,W);return g.t(C,Ki4(m),0)})},SFX=function(m){var c,W,A,p,R,L,M;
return g.D(function(b){if(b.j==1)return g.t(b,sEr(m),2);c=b.V;W=[];A=g.H(c);for(p=A.next();!p.done;p=A.next())R=p.value,L=g.Ng(R.key),M=L.entityId,Gbc(m.j,M)||W.push(R);return g.t(b,hCv(m,W),0)})},uEh=function(m){m=m*1E3-Date.now();
return m>4E3?4E3:m},aw4=function(m,c){var W,A,p;
return g.D(function(R){W=g.H(c);for(A=W.next();!A.done;A=W.next()){p=A.value;var L=void 0,M=void 0,b=((M=p.action)==null?void 0:(L=M.actionMetadata)==null?void 0:L.retryScheduleIntervalsInSeconds)||[1,2,4];L=1;p.retryScheduleIndex<b.length&&(L=b[p.retryScheduleIndex]);p.j=L*1E3+Date.now();p.retryScheduleIndex++}return g.t(R,E49(m,c),0)})},DCG=function(m){var c;
return g.D(function(W){if(W.j==1)return g.t(W,UZ(m.V,"offlineOrchestrationActionWrapperEntity"),2);c=W.V;return g.t(W,hCv(m,c),0)})},rlh=function(m,c){c.length!==0&&c.forEach(function(W){W=wP(W);
W.retryScheduleIndex<3&&dCH(m.j,[W])})},sEr=function(m,c){var W;
return g.D(function(A){if(A.j==1)return g.t(A,UZ(m.V,"offlineOrchestrationActionWrapperEntity",c),2);W=A.V;return A.return(W.filter(tma))})},E49=function(m,c){if(c.length===0)return Promise.resolve([]);
c=c.map(function(W){return C0(W)});
return xG4(m.V,c)},YFS=function(m){this.bl=m;
this.j=void 0},fw4=function(m,c){var W,A,p,R;
return g.D(function(L){W=c.videoId;A=!0;if(c.captionTracks.length)p=oJS(c),m.j=new g.DO(m.bl,c,p);else if(c.eS)R=g.LQy(c),m.j=new g.BL(m.bl,c.eS,W,R,c.SA,c.eventId),A=c.SA;else return L.return();return L.return(new Promise(function(M){var b;(b=m.j)==null||b.oP({YH:function(){return g.D(function(N){if(N.j==1)return g.t(N,m.YH(W,A),2);M();g.CN(N)})},
E_:function(){}})}))})},iD4=function(m){var c;
return g.D(function(W){if(W.j==1)return g.t(W,vM4(m),2);c=W.V;return W.return(!!c&&c.length>0)})},u_=function(m){g.n.call(this);
this.j=m;this.V=this.j.observe(this.K.bind(this))},Iwv=function(m,c){var W,A,p,R,L,M,b;
return g.D(function(N){switch(N.j){case 1:if(c.length===0)return N.return([]);W=c.map(function(Z){return g.Zk(Z,"transfer")});
return g.t(N,UZ(m.j,"transfer",W),2);case 2:A=N.V;p=A.filter(tma).map(function(Z){return g.Ng(Z.key).entityId});
R=c.filter(function(Z){return p.indexOf(Z)===-1});
if(R.length===0)return N.return([]);L=g.H(R);M=L.next();case 3:if(M.done){N.qh(5);break}b=M.value;return g.t(N,ZDa(b),4);case 4:M=L.next();N.qh(3);break;case 5:return N.return(R)}})},kbd=function(m,c,W,A,p,R){var L,M,b;
return g.D(function(N){L="STREAM_TYPE_UNKNOWN";W.video&&W.audio?(L="STREAM_TYPE_AUDIO_AND_VIDEO",WF("unexpected stream type")):W.video&&!W.audio?L="STREAM_TYPE_VIDEO":!W.video&&W.audio&&(L="STREAM_TYPE_AUDIO");M=g.Zk(c,"offlineVideoStreams");b={numBytesDownloaded:p.toFixed(),numTotalBytes:R.toFixed(),streamType:L,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(A),itag:L==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(W.itag):void 0};return g.t(N,iB(m,{mode:"readwrite",k$:!0},
function(Z){var F=rW(Z,M,"offlineVideoStreams"),Q=rW(Z,g.Zk(c,"transfer"),"transfer");return g.dx.all([F,Q]).then(function(w){w=g.H(w);var C=w.next().value;w=w.next().value;if(!w)return EZ(Z,M).then(function(){});
var x=PbS(C);C=UCd(C,A,b,M);var q=S3(Z,C,"offlineVideoStreams");PbS(C)>x&&(w.lastProgressTimeMs=Date.now().toString());x=[q];w.offlineVideoStreams||(w.offlineVideoStreams=[]);w.offlineVideoStreams.indexOf(M)===-1&&(w.offlineVideoStreams.push(M),x.push(S3(Z,w,"transfer")));return g.dx.all(x)})}),0)})},XgG=function(m,c){var W,A,p,R,L;
return g.D(function(M){if(M.j==1)return W=g.Zk(c,"offlineVideoStreams"),g.t(M,Pu(m,W,"offlineVideoStreams"),2);A=M.V;if(!A||!A.streamsProgress)return M.return();p=g.H(A.streamsProgress);for(R=p.next();!R.done;R=p.next())L=R.value,L.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",L.numTotalBytes!==L.numBytesDownloaded&&(L.numBytesDownloaded=L.numTotalBytes);return g.t(M,Ip(m,A,"offlineVideoStreams"),0)})},UCd=function(m,c,W,A){if(m&&m.streamsProgress){A=m;
a:{c=c.itag+";"+c.xtags;for(var p=m.streamsProgress,R=0;R<p.length;R++){var L=JSON.parse(p[R].formatStreamBytes);if(L.itag+";"+L.xtags===c){p[R]=W;W=p;break a}}p.push(W);W=p}A.streamsProgress=W}else m={key:A,streamsProgress:[W]};return m},PbS=function(m){if(m==null?0:m.streamsProgress){var c=0;
m=m.streamsProgress;for(var W=0;W<m.length;W++){var A=m[W];isNaN(Number(A.numBytesDownloaded))?WF("stream progress bytes number invalid"):c+=Number(A.numBytesDownloaded)}return c}return 0},miX=function(m,c,W,A){g.n.call(this);
var p=this;this.V=m;this.api=c;this.eg=W;this.Mh=A;this.B=new g.X1;this.L=new g.Rv(function(){p.j&&p.j.transferState==="TRANSFER_STATE_TRANSFERRING"&&p.B.P3()&&((p.j.transferRetryCount||0)<3?j6(p.X,p.U,!1,!1):vF(p.X,p.U.videoDetails.videoId),p.zY("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Vb=this.il=0;this.W=this.N=!1;this.Sg=g.gb(this.api.J().experiments,"html5_transfer_processing_logs_interval");this.XY=new g.nm(this);this.Km={rlo:function(){return p.L},
G4m:function(){return p.Mh},
OY:function(){return p.B}};
this.Kf=this.V.observe(this.ZP.bind(this));this.X=new N6h(c,this);this.Iq=new YFS(c);this.De=new u_(this.V);this.Cf=this.B.listen("publicytnetworkstatus-online",this.vM.bind(this));this.Rq=this.B.listen("publicytnetworkstatus-offline",this.LYo.bind(this));this.W=this.api.J().G("html5_less_transfer_processing_logs");g.r(this,this.XY);this.XY.S(c,"offlinetransferpause",this.DQ9);g.Er(this.api.J())?this.K="mainVideoDownloadStateEntity":g.hK(this.api.J())&&(this.K="musicTrackDownloadMetadataEntity")},
cdv=function(m){return g.D(function(c){if(c.j==1)c=g.t(c,Kgv(),2);
else{var W=m.De;var A=g.xZ();A=Object.keys(A);W=Iwv(W,A);c=g.t(c,W,0)}return c})},rP=function(m,c){c=c===void 0?!1:c;
var W;return g.D(function(A){if(A.j==1){if(m.j)throw Error("Already downloading a video");m.Vb=0;m.N=!1;return g.t(A,W$4(m),2)}return A.j!=4?(W=A.V,R6v(m.eg,!W),W&&m.B.P3()?c?g.t(A,new Promise(function(p){g.x8(p,1E3)}),4):A.qh(4):(!W&&m.j&&n0(m),A.qh(0))):g.t(A,AdS(m,W),0)})},pTG=function(m){return g.D(function(c){if(c.j==1)return m.U?g.t(c,vF(m.X,m.U.videoDetails.videoId),3):c.qh(0);
n0(m);g.CN(c)})},RRi=function(m,c){var W,A,p;
return g.D(function(R){switch(R.j){case 1:return g.JY(R,2),(W=!!c.captionTracks.length||!!c.eS)?g.t(R,iD4(c.videoId),4):R.return();case 4:return(A=R.V)?R.return():g.t(R,fw4(m.Iq,c),5);case 5:g.H$(R,0);break;case 2:p=g.lm(R),WF("Caption downloading error",p,c.cotn),g.CN(R)}})},AdS=function(m,c){var W,A,p,R,L,M;
return g.D(function(b){switch(b.j){case 1:if(m.N)return b.return();m.N=!0;m.j=c;W=g.Ng(m.j.key);A=W.entityId;p=void 0;if(m.j.transferState==="TRANSFER_STATE_TRANSFERRING")return g.t(b,hu(m,A),7);if(m.j.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||m.j.transferRetryCount||m.j.hasLoggedFirstStarted){b.qh(3);break}return g.t(b,hu(m,A),5);case 5:return p=b.V,m.j.hasLoggedFirstStarted=!0,g.t(b,L$h(m),6);case 6:L54({videoId:A,gr:m.j,offlineModeType:p},void 0,void 0,!0);b.qh(3);break;case 7:p=b.V,
OU({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:A,gr:m.j,offlineModeType:p});case 3:return g.t(b,ObX(m),8);case 8:return R=null,g.JY(b,9),g.t(b,MPh(m,c),11);case 11:R=b.V;m.U=R;g.H$(b,10);break;case 9:return L=g.lm(b),WF("error getting player response",L,c.cotn),g.t(b,m.zY("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return b.return();case 10:return M=ZoG(m.api.J(),c.cotn,R),g.t(b,RRi(m,M),13);case 13:return g.t(b,o44(M.videoId),
14);case 14:M.F1=b.V,wga(m.X,M,c.maximumDownloadQuality),m.L.start(108E5),g.CN(b)}})},W$4=function(m){var c,W;
return g.D(function(A){if(A.j==1)return g.t(A,UZ(m.V,"transfer"),2);c=A.V;W=c.filter(bbr).sort($iv);return W.length===0?A.return():A.return(W[0])})},ObX=function(m){var c,W,A;
return g.D(function(p){if(p.j==1){if(!m.j)return sU(m,"onTransferStart"),p.return();m.L.start(108E5);return g.t(p,S6(m,"TRANSFER_STATE_TRANSFERRING"),2)}c=m.j;return(A=((W=c)==null?0:W.key)?g.Ng(c.key).entityId:"")&&m.K?g.t(p,Zg(A,m.K,m.V,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):p.qh(0)})},QEh=function(m){var c,W,A,p;
g.D(function(R){switch(R.j){case 1:if(!m.j){sU(m,"onTransferPausedByUser");R.qh(2);break}c=m.j;m.L.stop();return g.t(R,S6(m,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:A=((W=c)==null?0:W.key)?g.Ng(c.key).entityId:"";if(!A||!m.K){R.qh(4);break}return g.t(R,Zg(A,m.K,m.V,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.t(R,hu(m,A),6);case 6:p=R.V,OoH({videoId:A,gr:c,offlineModeType:p});case 2:n0(m),rP(m),g.CN(R)}})},g44=function(m){var c,W,A;
g.D(function(p){if(p.j==1){if(!m.j)return sU(m,"onTransferPausedByNetwork"),p.return();m.L.stop();return g.t(p,S6(m,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(p.j!=3)return c=m.j,(A=((W=c)==null?0:W.key)?g.Ng(c.key).entityId:"")&&m.K?g.t(p,Zg(A,m.K,m.V,"DOWNLOAD_STATE_PAUSED"),3):p.qh(3);n0(m);g.CN(p)})},NJc=function(m){var c,W,A,p,R;
g.D(function(L){switch(L.j){case 1:if(!m.j)return sU(m,"onTransferComplete"),L.return();c=m.j;m.L.stop();if(!c||!m.U){L.qh(2);break}W=ZoG(m.api.J(),c.cotn,m.U);return g.t(L,RRi(m,W),2);case 2:return g.t(L,S6(m,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:p=((A=c)==null?0:A.key)?g.Ng(c.key).entityId:"";if(!p||!m.K){L.qh(5);break}return g.t(L,Zg(p,m.K,m.V,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.t(L,XgG(m.V,p),7);case 7:return g.t(L,hu(m,p),8);case 8:R=L.V,OU({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:p,gr:c,offlineModeType:R}),n0(m),rP(m),g.CN(L)}})},ZbG=function(m,c,W){var A,p;
g.D(function(R){switch(R.j){case 1:if(!m.j)return sU(m,"onTransferProgress: "+c),R.return();if(m.j.transferState==="TRANSFER_STATE_TRANSFERRING"){R.qh(2);break}return g.t(R,ObX(m),2);case 2:A=Date.now();if(!(A-m.il>1E3)){R.qh(4);break}m.il=A;return g.t(R,kbd(m.V,W.videoId,W.V,W.QP,W.bytesDownloaded,W.j),5);case 5:if(m.W&&!(m.W&&A-m.Vb>m.Sg)){R.qh(4);break}m.Vb=A;return g.t(R,hu(m,c),7);case 7:p=R.V,L54({videoId:c,gr:m.j,offlineModeType:p},W.bytesDownloaded,W.j);case 4:m.L.start(108E5),g.CN(R)}})},
oxG=function(m){var c=(m.j.transferRetryCount||0)<3;
c&&(m=m.j,m.transferRetryCount=(m.transferRetryCount||0)+1);return c},F$v=function(m,c){c=c===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":c;
var W,A,p,R;return g.D(function(L){if(L.j==1)return m.j||sU(m,"setTransferToFailed: "+c),W="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c==="TRANSFER_FAILURE_REASON_NETWORK"?W="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":c==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(W="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.t(L,S6(m,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",c),2);if(L.j!=3)return p0(m.Mh,{entityKey:(A=m.j)==null?void 0:A.key,failureReason:W}),
p=m.j?g.Ng(m.j.key).entityId:"",g.t(L,hu(m,p),3);R=L.V;var M={videoId:p,gr:m.j,offlineModeType:R},b=c,N={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};b&&(N.transferFailureReason=b,N.failureReason=MfQ(b));OU(N,M);g.CN(L)})},S6=function(m,c,W,A){var p;
return g.D(function(R){if(R.j==1){if(!m.j)return sU(m,"saveTransferState: "+c),R.return();m.j.transferState=c;m.j.failureReason=A;g.JY(R,2);return g.t(R,L$h(m,function(L){return W?hO(L,"offlineVideoStreams",m.j.offlineVideoStreams).then(function(M){for(var b=g.H(M),N=b.next();!N.done;N=b.next())if((N=N.value)&&N.streamsProgress){N=g.H(N.streamsProgress);for(var Z=N.next();!Z.done;Z=N.next())Z.value.streamState=W}return oMG(L,M.filter(function(F){return!!F}),"offlineVideoStreams")}):g.dx.resolve(void 0)}),
4)}if(R.j!=2)return g.H$(R,0);
p=g.lm(R);return p instanceof g.xK&&p.type==="QUOTA_EXCEEDED"?g.t(R,m.zY("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):R.qh(0)})},L$h=function(m,c){var W;
return g.D(function(A){if(!m.j)return A.return();W=m.j;return g.t(A,iB(m.V,{mode:"readwrite",k$:!0},function(p){var R=[S3(p,W,"transfer")];c&&R.push(c(p));return g.dx.all(R)}),0)})},n0=function(m){m.j=void 0;
m.U=void 0;m.L.stop()},MPh=function(m,c){var W,A,p,R,L;
return g.D(function(M){if(M.j==1)return W=g.Ng(c.key),A=W.entityId,p=g.Zk(A,"playbackData"),g.t(M,Pu(m.V,p,"playbackData"),2);R=M.V;if((L=R)==null?0:L.playerResponseJson)return M.return(JSON.parse(R.playerResponseJson));throw Error("No PlayerResponse found");})},sU=function(m,c){m.api.nf("woffle",{mcte:c});
WF("missing current transfer entity.")},hu=function(m,c){var W,A,p;
return g.D(function(R){if(R.j==1)return g.t(R,Pu(m.V,g.Zk(c,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);W=R.V;return R.return((p=(A=W)==null?void 0:A.offlineModeType)!=null?p:void 0)})},bbr=function(m){return Q99[m.transferState]!==void 0},$iv=function(m,c){var W=Q99[m.transferState],A=Q99[c.transferState];
return W!==A?W-A:Number(m.enqueuedTimestampMs)-Number(c.enqueuedTimestampMs)},EU=function(m,c){var W=this;
this.Ag=m;this.api=c;this.B=new g.X1;this.U=new g.ln;this.Km={h1:function(){return W.K.Km.h1()},
OY:function(){return W.B},
ylg:function(){return W.K},
o3:function(){return W.o3()},
YB:function(){return W.YB()},
F5:function(){return W.F5()},
jd:function(){return W.jd()},
Fm:function(){return W.Fm()},
k7:function(A){return W.k7(A)}};
this.K=new cU9(function(){return gxd(W)},function(){W.F5()},this.api.q6(),this.api.G.bind(this.api));
this.j=new Au(this.api);W5X(this.K)},gxd=function(m){return g.D(function(c){m.api.r_("onOrchestrationBecameLeader");
return g.t(c,m.YB(),0)})},CO4=function(m){var c,W;
return g.D(function(A){if(A.j==1)return g.t(A,ku(),2);if(A.j!=3){c=A.V;if(!c)return WF("PES is undefined"),A.return();m.V=new miX(c,m.api,m.K,m.j);W=m.Im(c);return g.t(A,B6G(c,W,m.K,m.j,m.Ag),3)}m.X=A.V;return g.t(A,wTv(m),0)})},wTv=function(m){var c;
return g.D(function(W){switch(W.j){case 1:if(!m.V)return WF("transferManager is undefined"),W.return();if(m.V.j){W.qh(2);break}return g.t(W,rP(m.V),2);case 2:if(!m.Ag.G("woffle_enable_main_downloads_library")){W.qh(4);break}return g.t(W,m.aC(),4);case 4:if(!m.Ag.G("html5_offline_playback_position_sync")){W.qh(6);break}return g.t(W,m.LU(),7);case 7:return g.t(W,m.k7(864E5),6);case 6:return g.t(W,m.refreshAllStaleEntities(43200,!0),9);case 9:return g.t(W,m.b5(),10);case 10:if(!m.Ag.G("html5_retry_downloads_for_expiration")){W.qh(11);
break}return g.t(W,m.Fm(),11);case 11:return m.N=g.lT(function(){m.refreshAllStaleEntities(43200,!0);m.b5()},9E5),g.pq(g.Lq(),function(){return m.jd()}),g.t(W,ku(),13);
case 13:return c=W.V,g.t(W,mRi(c),14);case 14:AUh(m.K),g.CN(W)}})},Jd9=function(){var m,c,W,A,p,R;
return g.D(function(L){switch(L.j){case 1:return g.t(L,ku(),2);case 2:m=L.V;if(!m)return L.return([]);c=Date.now()/1E3;return g.t(L,UZ(m,"offlineVideoPolicy"),3);case 3:W=L.V,A=g.H(W),p=A.next();case 4:if(p.done){L.qh(6);break}R=p.value;if(!(R.expirationTimestamp&&Number(R.expirationTimestamp)<c)){L.qh(5);break}R.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";R.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.t(L,Ip(m,R,"offlineVideoPolicy"),5);
case 5:p=A.next();L.qh(4);break;case 6:return L.return(W.map(function(M){return M.key}))}})},YO=function(m,c,W,A,p){var R,L,M;
return g.D(function(b){if(b.j==1)return g.t(b,ku(),2);R=b.V;if(!R)return b.return([]);L=c.map(function(N){var Z=g.Zk(N,W);Z={actionType:A,entityKey:Z,actionMetadata:Object.assign({},ocS(),p)};A!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(Z.actionMetadata.priority=0);N=new gP(W,N,Z);return C0(N)});
M=xG4(R,L);W5X(m.K);return b.return(M)})},VPS=function(m,c,W,A){var p,R,L,M,b,N,Z,F;
return g.D(function(Q){switch(Q.j){case 1:p=[],R=g.H(c),L=R.next();case 2:if(L.done){Q.qh(4);break}M=L.value;if(M.upToDate||W&&!M.shouldAutoSyncMetadata||!M.playlistId){Q.qh(3);break}b={};switch(A){case "mainPlaylistEntity":N={nextAutoRefreshIntervalSeconds:M.checkInSeconds,autoSync:W};b={mainPlaylistEntityActionMetadata:N};break;case "musicPlaylist":Z={autoSync:W},b={musicPlaylistEntityActionMetadata:Z}}return g.t(Q,YO(m,[M.playlistId],A,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b),6);case 6:(F=
Q.V)&&p.push.apply(p,g.l(F));case 3:L=R.next();Q.qh(2);break;case 4:return Q.return(p)}})},Hb4=function(m,c){var W;
return g.D(function(A){return c.length?(W=ocS(),g.Sy(W,K0,{isEnqueuedForExpiredStreamUrlRefetch:!0}),m.api.nf("qrd",{v:c.length}),A.return(YO(m,c,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W))):A.return([])})},xia=function(m,c,W){this.j=m;
this.Ag=c;this.K=W},TJ9=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e;
return g.D(function(G){switch(G.j){case 1:return W=Mu(c),A=g.Ng(c.entityKey),p=A.entityId,R=[],g.JY(G,2),g.t(G,l8d(m,p),4);case 4:R=G.V;if(!(m.Ag.G("woffle_enable_main_downloads_library")&&((L=R)==null?0:L.length))){G.qh(5);break}return g.t(G,yU9(m.j,[c.entityKey]),5);case 5:g.H$(G,3);break;case 2:return M=g.lm(G),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.xK&&M.type==="QUOTA_EXCEEDED"?(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):WF("Playlist add error"),G.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,b,N));case 3:Z=[];if(!m.Ag.G("html5_offline_prevent_redownload_downloaded_video")){G.qh(7);break}return g.t(G,N_G(m.j,"mainVideoEntity",R),8);case 8:R=G.V;case 7:if((F=R)==null?0:F.length)for(Q=g.H(R),w=Q.next();!w.done;w=Q.next())if(C=w.value,x=C.offlineVideoData,q=void 0,(q=x)==null?0:q.videoId)y=void 0,e=Number(((y=c.actionMetadata)==null?void 0:y.priority)||
0)+1,Z.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x.videoId,"mainVideoEntity",e,f0,qVr(c,x,p)));return G.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,Z))}})},zRh=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5,X,S,P,V,Y,m4,xh,Wr,er,U5,pd,wi,T,z,d,K,a,c$,RU,LN,v,NK,gE,bm,DQ,NQ,hc,F0,Yy,nn,$S,D5,Ei,Fm,hg,rn,sn,Ve,Qs,K1,ot,BX,ae,uE,ee,kl,S7,Ln,T$,SR;
return g.D(function(QO){switch(QO.j){case 1:return W=Mu(c),A=c.entityKey,p=g.Ng(A).entityId,R=[],L=!1,p==="!*$_ALL_ENTITIES_!*$"?(L=!0,g.t(QO,UZ(m.j,"mainPlaylistEntity"),5)):g.t(QO,Pu(m.j,A,"mainPlaylistEntity"),4);case 4:(M=QO.V)&&R.push(M);QO.qh(3);break;case 5:R=QO.V;case 3:if((b=R)==null||!b.length)return QO.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));N=g.h(c.actionMetadata,yd9);F=(Z=N)==null?void 0:Z.nextAutoRefreshIntervalSeconds;w=(Q=N)==null?void 0:Q.autoSync;C=[];q=x=
!0;y=!1;if(!L&&w===!1){QO.qh(6);break}g.JY(QO,7);return g.t(QO,rUv(0,!!w,!0,R),9);case 9:C=QO.V;g.H$(QO,8);break;case 7:e=g.lm(QO);if(!(e instanceof Error&&e.message==="No data")){e instanceof Error&&e.message==="Empty response body"&&WF(e.message);QO.qh(8);break}return p==="!*$_ALL_ENTITIES_!*$"?g.t(QO,Vfc(m.j,c,m.K,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.t(QO,Coc(p,m.j,c,m.K),8);case 8:if(!C.length||!L&&C[0].playlistId!==p)return QO.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
W));case 6:if(L){G=[];B=g.H(C);for(u=B.next();!u.done;u=B.next())E=u.value,E.upToDate||w&&!E.shouldAutoSyncMetadata||!E.playlistId||(I={nextAutoRefreshIntervalSeconds:E.checkInSeconds,autoSync:w},G.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",E.playlistId,"mainPlaylistEntity",0,f0,{mainPlaylistEntityActionMetadata:I})));return QO.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,G))}C.length&&(AY=C[0],y=!!AY.upToDate,w&&(x=(O5=AY.shouldAutoSyncMetadata)!=null?O5:!0,q=(X=AY.shouldAutoSyncVideos)!=
null?X:!0,AY.checkInSeconds&&(F=AY.checkInSeconds)));if(y||!x)return QO.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));S=[];P=R[0];if(!P.downloadState){V=void 0;QO.qh(15);break}return g.t(QO,Pu(m.j,P.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:V=QO.V;case 15:return Y=V,xh=((m4=Y)==null?0:m4.addedTimestampMillis)?String(Y.addedTimestampMillis):void 0,g.JY(QO,17),g.t(QO,l8d(m,p,xh,F),19);case 19:S=QO.V;g.H$(QO,18);break;case 17:Wr=g.lm(QO);if(!(Wr instanceof Error&&
Wr.message==="No data for playlist")){if(Wr instanceof Error&&Wr.message==="Empty response body for playlist")WF(Wr.message);else return er="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Wr instanceof g.xK&&Wr.type==="QUOTA_EXCEEDED"&&(er="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",U5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),QO.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,er,U5));QO.qh(18);
break}return g.t(QO,Coc(p,m.j,c,m.K),18);case 18:if(!q)return QO.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));pd=[];wi=new Map;if((T=S)==null?0:T.length)for(z=g.H(S),d=z.next();!d.done;d=z.next())K=d.value,a=K.offlineVideoData,c$=void 0,((c$=a)==null?0:c$.videoId)&&wi.set(a.videoId,a);RU=new Map;LN=[];if((v=P)==null?0:(NK=v.videos)==null?0:NK.length)for(gE=g.H(P.videos),bm=gE.next();!bm.done;bm=gE.next())if(DQ=bm.value,NQ=JSON.parse(g.Ng(DQ).entityId),hc=NQ.videoId)wi.has(hc)?(RU.set(hc,
wi.get(hc)),wi.delete(hc)):LN.push(hc);Yy=Number(((F0=c.actionMetadata)==null?void 0:F0.priority)||0)+1;nn=g.H(wi.entries());for($S=nn.next();!$S.done;$S=nn.next())D5=$S.value,Ei=g.H(D5),Fm=Ei.next().value,hg=Ei.next().value,rn=Fm,sn=hg,pd.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",rn,"mainVideoEntity",Yy,f0,qVr(c,sn,p)));Ve=g.H(RU.entries());for(Qs=Ve.next();!Qs.done;Qs=Ve.next())K1=Qs.value,ot=g.H(K1),BX=ot.next().value,ae=ot.next().value,uE=BX,ee=ae,pd.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
uE,"mainVideoEntity",Yy,f0,qVr(c,ee,p)));kl=g.H(LN);for(S7=kl.next();!S7.done;S7=kl.next())Ln=S7.value,T$={playlistId:p},SR={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:T$},pd.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Ln,"mainVideoEntity",0,f0,SR));return QO.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,pd))}})},eRr=function(m,c){var W,A,p,R;
return g.D(function(L){switch(L.j){case 1:return W=Mu(c),g.JY(L,2),A=g.Ng(c.entityKey).entityId,A==="!*$_ALL_ENTITIES_!*$"?g.t(L,Vfc(m.j,c,m.K,(p=c.actionMetadata)==null?void 0:(R=p.offlineLoggingData)==null?void 0:R.offlineDeleteReason),5):g.t(L,Coc(A,m.j,c,m.K),6);case 6:if(!m.Ag.G("woffle_enable_main_downloads_library")){L.qh(5);break}return g.t(L,z6h(m.j,c.entityKey),5);case 5:g.H$(L,3);break;case 2:return g.lm(L),L.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return L.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W))}})},l8d=function(m,c,W,A){var p,R,L,M,b,N,Z;
return g.D(function(F){switch(F.j){case 1:return g.t(F,uN9([c]),2);case 2:return p=F.V,g.t(F,diS(m,p[0],W,A),3);case 3:return R=F.V,L=R.mainPlaylistEntity,M=R.RK8,N=gcd(L,(b=M)==null?void 0:b.avatar),g.JY(F,4),g.t(F,Vj(N),6);case 6:g.H$(F,5);break;case 4:Z=g.lm(F),Z instanceof Error&&Z.message==="Failed to fetch"&&WF(Z.message);case 5:return F.return(p[0].videos)}})},diS=function(m,c,W,A){var p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B;
return g.D(function(u){switch(u.j){case 1:p=Date.now().toString();W||(W=p);R=c.videos;L=c.playlistId;M=[];b=[];if(R)for(N=g.H(R),Z=N.next();!Z.done;Z=N.next()){F=Z.value;Q=F.offlineVideoData;if(!Q||!Q.videoId)throw WF("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");w=Q.videoId;C={videoId:w,playlistId:L};x={id:g.Zk(JSON.stringify(C),"mainPlaylistVideoEntity"),video:g.Zk(w,"mainVideoEntity")};M.push(x);b.push(x.id)}y={key:g.Zk(L,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:W,lastSyncedTimestampMillis:p};e={key:g.Zk(L,"mainPlaylistEntity"),playlistId:L,videos:b,title:c.title,thumbnailStyleData:tPS(c),visibility:G$4(c),downloadState:y.key};c.channel&&(G=c.channel.offlineChannelData,q=Div(g.Zk(L,"ytMainChannelEntity"),G),e.channelOwner=q.id);((B=e)==null?0:B.entityMetadata)?(e.entityMetadata.offlineLastModifiedTimestampSeconds=c.lastModifiedTimestamp,A&&(e.entityMetadata.nextAutoRefreshIntervalSeconds=String(A))):e&&(e.entityMetadata={nextAutoRefreshIntervalSeconds:A?
String(A):void 0,offlineLastModifiedTimestampSeconds:c.lastModifiedTimestamp});g.JY(u,2);return g.t(u,iB(m.j,{mode:"readwrite",k$:!0},function(E){var I=S3(E,e,"mainPlaylistEntity"),AY=S3(E,y,"mainPlaylistDownloadStateEntity");I=[I,AY];AY=g.H(M);for(var O5=AY.next();!O5.done;O5=AY.next())I.push(S3(E,O5.value,"mainPlaylistVideoEntity"));q&&I.push(S3(E,q,"ytMainChannelEntity"));return g.dx.all(I)}),4);
case 4:g.H$(u,3);break;case 2:throw g.lm(u),WF("PES failure for playlist"),Error("PES failure for playlist");case 3:return u.return({mainPlaylistEntity:e,RK8:q,NLf:M})}})},Div=function(m,c){return{id:m,
channelId:c.channelId,title:c.title,avatar:c.thumbnail}},tPS=function(m){var c=[],W=m.videos;
W&&W.length>0&&c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:W[0].offlineVideoData.thumbnail}}});if((m=m.additionalMetadadatas)&&m.length>0)for(m=g.H(m),W=m.next();!W.done;W=m.next()){var A=W.value.offlineBundleItemPlaylistData,p=void 0;W=(p=A)==null?void 0:p.style;p=void 0;A={collageThumbnail:{coverThumbnail:(p=A)==null?void 0:p.coverThumbnail}};switch(W){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:A});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:A});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:A});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:A})}}return c},G$4=function(m){switch(m.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},qVr=function(m,c,W){c={offlineVideoData:c,
playlistId:W};if(m=g.h(m.actionMetadata,yd9))c.maximumDownloadQuality=m.maximumDownloadQuality;return{mainVideoEntityActionMetadata:c}},K$4=function(m,c,W){this.j=m;
this.Ag=c;this.K=W},j9H=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C;
return g.D(function(x){switch(x.j){case 1:return W=Mu(c),A=g.Ng(c.entityKey),p=A.entityId,R=g.h(c.actionMetadata,i_),M=!((L=R)==null?0:L.playlistId),g.JY(x,2),g.t(x,BJd(m,p,void 0,(b=R)==null?void 0:b.offlineVideoData,M),4);case 4:g.H$(x,3);break;case 2:return N=g.lm(x),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.xK&&N.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
x.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,Z,F));case 3:Q=1;Q=Number(((w=c.actionMetadata)==null?void 0:w.priority)||0)+1;var q=(q=g.h(c.actionMetadata,i_))?{playbackDataActionMetadata:{maximumDownloadQuality:q.maximumDownloadQuality}}:void 0;C=Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"playbackData",Q,vxv,q);return x.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,[C]))}})},a8h=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e;
return g.D(function(G){switch(G.j){case 1:return W=Mu(c),A=g.Ng(c.entityKey),p=A.entityId,g.t(G,Pu(m.j,c.entityKey,"mainVideoEntity"),2);case 2:R=G.V;if(!R){L=void 0;G.qh(3);break}return g.t(G,Pu(m.j,R.downloadState,"mainVideoDownloadStateEntity"),4);case 4:L=G.V;case 3:M=L;if(!R||!M)return G.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));g.JY(G,5);return g.t(G,BJd(m,p,M.addedTimestampMillis,(N=g.h(c.actionMetadata,i_))==null?void 0:N.offlineVideoData),7);case 7:Z=1;Z=Number(((F=
c.actionMetadata)==null?void 0:F.priority)||0)+1;b=Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",p,"playbackData",Z,vxv);g.H$(G,6);break;case 5:Q=g.lm(G);if(!(Q instanceof Error&&Q.message==="No data")){if(Q instanceof Error&&Q.message==="Empty response body")WF(Q.message);else return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Q instanceof g.xK&&Q.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),G.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,w,C));G.qh(6);break}return g.t(G,l_(m.j,p),9);case 9:x=G.V;q=g.h(c.actionMetadata,i_);if(e=(y=q)==null?void 0:y.playlistId)x.playlistId=e;x.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.t(G,HF(p,m.j,c,m.K,x),6);case 6:return G.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,b?[b]:void 0))}})},u89=function(m,c){var W,A,p,R,L,M,b,N,Z,F;
return g.D(function(Q){switch(Q.j){case 1:return W=Mu(c),g.JY(Q,2),A=g.Ng(c.entityKey).entityId,A==="!*$_ALL_ENTITIES_!*$"?g.t(Q,Vfc(m.j,c,m.K,(Z=c.actionMetadata)==null?void 0:(F=Z.offlineLoggingData)==null?void 0:F.offlineDeleteReason),5):g.t(Q,l_(m.j,A),6);case 6:p=Q.V;R=g.h(c.actionMetadata,i_);if(M=(L=R)==null?void 0:L.playlistId)p.playlistId=M;p.offlineDeleteReason=(b=c.actionMetadata)==null?void 0:(N=b.offlineLoggingData)==null?void 0:N.offlineDeleteReason;return g.t(Q,HF(A,m.j,c,m.K,p),7);
case 7:if(!m.Ag.G("woffle_enable_main_downloads_library")){Q.qh(5);break}return g.t(Q,z6h(m.j,c.entityKey),5);case 5:g.H$(Q,3);break;case 2:return g.lm(Q),Q.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Q.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W))}})},BJd=function(m,c,W,A,p){var R,L,M,b,N,Z;
return g.D(function(F){switch(F.j){case 1:if(R=A){F.qh(2);break}return g.t(F,aia([c]),3);case 3:L=F.V,R=L[0];case 2:return g.t(F,nxQ(m,R,W,p),4);case 4:M=F.V;b=M.mainVideoEntity;N=M.channelEntity;g.JY(F,5);var Q=Qj(b.thumbnail),w=Qj(N.avatar);return g.t(F,Vj(Q.concat(w)),7);case 7:g.H$(F,0);break;case 5:Z=g.lm(F),Z instanceof Error&&Z.message==="Failed to fetch"&&WF(Z.message),g.CN(F)}})},nxQ=function(m,c,W,A){var p,R,L,M,b,N,Z,F,Q,w,C,x,q;
return g.D(function(y){switch(y.j){case 1:W||(W=Date.now().toString());R=(p=c.channel)==null?void 0:p.offlineChannelData;L={id:g.Zk(c.videoId,"ytMainChannelEntity"),channelId:R.channelId,title:R.title,avatar:R.thumbnail};M={key:g.Zk(c.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Zk(c.videoId,"playbackData"),addedTimestampMillis:W,videoDownloadContextEntity:g.Zk(c.videoId,"videoDownloadContextEntity")};b={key:g.Zk(c.videoId,"videoPlaybackPositionEntity"),videoId:c.videoId,lastPlaybackPositionSeconds:"0"};
m.Ag.G("html5_offline_playback_position_sync")&&(N={playbackPosition:b.key});Z=g.Zk(c.videoId,"mainVideoEntity");F={key:Z,videoId:c.videoId,title:c.title,thumbnail:c.thumbnail,localizedStrings:{viewCount:c.shortViewCountText},userState:N,lengthSeconds:c.lengthSeconds?Number(c.lengthSeconds):void 0,publishedTimestampMillis:c.publishedTimestamp?(Number(c.publishedTimestamp)*1E3).toString():void 0,formattedDescription:c.description,owner:L.id,downloadState:M.key};if(!m.Ag.G("woffle_enable_main_downloads_library")||
!A){y.qh(2);break}return g.t(y,T_H(m.j,[Z]),3);case 3:if(C=y.V)Q=C.mainDownloadsLibraryEntity,w=C.mainDownloadsListEntity;case 2:return q=$Rc,x={key:g.Zk(c.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Sy(M,q,x),g.t(y,iB(m.j,{mode:"readwrite",k$:!0},function(e){var G=S3(e,L,"ytMainChannelEntity"),B=S3(e,M,"mainVideoDownloadStateEntity"),u=S3(e,F,"mainVideoEntity");G=[G,B,u];m.Ag.G("html5_offline_playback_position_sync")&&(B=S3(e,b,"videoPlaybackPositionEntity"),
G.push(B));Q&&(B=S3(e,Q,"mainDownloadsLibraryEntity"),G.push(B));w&&(B=S3(e,w,"mainDownloadsListEntity"),G.push(B));x&&(e=S3(e,x,"downloadStatusEntity"),G.push(e));return g.dx.all(G)}),4);
case 4:return y.return({mainVideoEntity:F,channelEntity:L})}})},rdi=function(m,c,W){this.j=m;
this.Ag=c;this.K=W},s9H=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5,X,S,P;
return g.D(function(V){switch(V.j){case 1:return W=Mu(c),A=[],g.t(V,ap.getInstance(),2);case 2:p=V.V;if(!p){V.qh(3);break}return g.t(V,p.get("sdois"),4);case 4:return R=V.V,g.t(V,(M=p)==null?void 0:M.get("lmqf"),5);case 5:L=V.V;case 3:g.JY(V,6);if(R===void 0)throw Error("prefStorage or opt-in state is undefined");b=[];if(R){V.qh(8);break}return g.t(V,qgh(m.j),9);case 9:b=V.V,b.reverse();case 8:if(!b.length){V.qh(10);break}N=g.H(b);Z=N.next();case 11:if(Z.done){V.qh(10);break}F=Z.value;if(!F){V.qh(12);
break}Q=g.Ng(F).entityId;return g.t(V,l_(m.j,Q),14);case 14:return w=V.V,w.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.t(V,HF(Q,m.j,{entityKey:F,actionType:c.actionType},m.K,w),12);case 12:Z=N.next();V.qh(11);break;case 10:return g.t(V,s3d(R,(C=L)!=null?C:"SD"),16);case 16:return x=V.V,g.t(V,Ho4(x),17);case 17:q=lir(x);if(!m.Ag.G("woffle_enable_main_downloads_library")){V.qh(18);break}if(R){V.qh(19);break}return g.t(V,z6h(m.j,g.GT),19);case 19:return g.t(V,yU9(m.j,[g.GT]),18);
case 18:if((y=q)==null?0:y.length)for(e=g.H(q),G=e.next();!G.done;G=e.next())if(u=B=G.value,E=u.actionType,I=u.entityKey,AY=u.actionMetadata,E&&I&&AY&&!g.h(AY,hR4)){E==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(AY.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(O5=g.h(B.actionMetadata,i_))O5.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",B.actionMetadata=Object.assign({},B.actionMetadata,{mainVideoEntityActionMetadata:O5});A.push(B)}g.H$(V,7);break;
case 6:return X=g.lm(V),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.xK&&X.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),V.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,S,P));case 7:return V.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,A))}})},SVX=function(){EU.apply(this,arguments);
this.W="mainVideoEntity"},Exc=function(m,c,W){c=c===void 0?43200:c;
W=W===void 0?!0:W;var A=A===void 0?!1:A;var p,R,L;return g.D(function(M){switch(M.j){case 1:if(!m.B.P3())return M.return([]);p=[];g.JY(M,2);return g.t(M,rUv(c,W,A),4);case 4:p=M.V;g.H$(M,3);break;case 2:R=g.lm(M),R instanceof Error&&R.message==="No data"||R instanceof Error&&R.message==="Empty response body"&&WF(R.message);case 3:return L=VPS(m,p,W,"mainPlaylistEntity"),M.return(L)}})},YV4=function(m,c,W,A){A=A===void 0?!1:A;
var p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e;return g.D(function(G){switch(G.j){case 1:return p=[],g.t(G,h6v(),2);case 2:return(R=G.V)||A?g.t(G,Sgh(c,W),3):G.return([]);case 3:L=G.V;if((M=L)==null||!M.length)return G.return([]);b={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};N=g.H(L);Z=N.next();case 4:if(Z.done){G.qh(6);break}Q=F=Z.value;w=Q.actionType;C=Q.entityKey;x=Q.actionMetadata;if(!(w&&C&&x)||g.h(x,hR4)){G.qh(5);break}w==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(x.offlineLoggingData=
b);q=g.Ng(C);y=q.entityId;return g.t(G,YO(m,[y],"mainVideoEntity",w,x),8);case 8:e=G.V,p=p.concat(e);case 5:Z=N.next();G.qh(4);break;case 6:return G.return(p)}})},f8H=function(m,c){this.j=m;
this.K=c},I84=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y;
return g.D(function(e){switch(e.j){case 1:return W=Mu(c),A=g.Ng(c.entityKey),p=A.entityId,R=[],g.JY(e,2),g.t(e,ibS(m,p),4);case 4:R=e.V;if((L=R)==null||!L.length){e.qh(5);break}return g.t(e,DRr(m.j,c.entityKey),5);case 5:g.H$(e,3);break;case 2:return M=g.lm(e),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.xK&&M.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
e.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,b,N));case 3:return Z=[],g.t(e,N_G(m.j,"musicTrack",R),7);case 7:R=e.V;if(R.length)for(F=g.H(R),Q=F.next();!Q.done;Q=F.next())if(w=Q.value,C=w.offlineVideoData,x=void 0,(x=C)==null?0:x.videoId)q=void 0,y=Number(((q=c.actionMetadata)==null?void 0:q.priority)||0)+1,Z.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",C.videoId,"musicTrack",y,Ij,zv(c,C,p)));return e.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,Z))}})},
POd=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5,X,S,P,V,Y,m4,xh,Wr,er,U5,pd,wi,T,z,d,K,a,c$,RU,LN,v,NK,gE,bm,DQ,NQ,hc,F0,Yy,nn,$S,D5,Ei,Fm,hg;
return g.D(function(rn){switch(rn.j){case 1:return W=Mu(c),A=c.entityKey,p=g.Ng(A).entityId,R=[],L=!1,p==="!*$_ALL_ENTITIES_!*$"?(L=!0,g.t(rn,UZ(m.j,"musicAlbumRelease"),5)):g.t(rn,Pu(m.j,A,"musicAlbumRelease"),4);case 4:(M=rn.V)&&R.push(M);rn.qh(3);break;case 5:R=rn.V;case 3:if((b=R)==null||!b.length)return rn.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));if(L){N=[];Z=g.H(R);for(F=Z.next();!F.done;F=Z.next())Q=F.value,w=g.Ng(Q.id).entityId,N.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
w,"musicAlbumRelease",0,Ij));return rn.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,N))}C=[];x=R[0];q=void 0;if(!x.downloadMetadata){rn.qh(6);break}return g.t(rn,Pu(m.j,x.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:y=rn.V,q=Number((G=(e=y)==null?void 0:e.addedTimestampMillis)!=null?G:"0")/1E3;case 6:return g.JY(rn,8),g.t(rn,ibS(m,p,(B=q)==null?void 0:B.toString()),10);case 10:C=rn.V;g.H$(rn,9);break;case 8:u=g.lm(rn);if(!(u instanceof Error&&u.message===
"No data")){if(u instanceof Error&&u.message==="Empty response body")WF(u.message);else return E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",I="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.xK&&u.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",I="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),rn.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,E,I));rn.qh(9);break}return g.t(rn,Tv(p,"musicAlbumRelease",m.j,
c,m.K),9);case 9:AY=[];O5=new Map;if((X=C)==null?0:X.length)for(S=g.H(C),P=S.next();!P.done;P=S.next())V=P.value,Y=V.offlineVideoData,m4=void 0,((m4=Y)==null?0:m4.videoId)&&O5.set(Y.videoId,Y);xh=new Map;Wr=[];if((er=x)==null?0:(U5=er.tracks)==null?0:U5.length)for(pd=g.H(x.tracks),wi=pd.next();!wi.done;wi=pd.next())if(T=wi.value,z=g.Ng(T).entityId)O5.has(z)?(xh.set(z,O5.get(z)),O5.delete(z)):Wr.push(z);K=Number(((d=c.actionMetadata)==null?void 0:d.priority)||0)+1;a=g.H(O5.entries());for(c$=a.next();!c$.done;c$=
a.next())RU=c$.value,LN=g.H(RU),v=LN.next().value,NK=LN.next().value,gE=v,bm=NK,AY.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",gE,"musicTrack",K,Ij,zv(c,bm)));DQ=g.H(xh.entries());for(NQ=DQ.next();!NQ.done;NQ=DQ.next())hc=NQ.value,F0=g.H(hc),Yy=F0.next().value,nn=F0.next().value,$S=Yy,D5=nn,AY.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",$S,"musicTrack",K,Ij,zv(c,D5)));Ei=g.H(Wr);for(Fm=Ei.next();!Fm.done;Fm=Ei.next())hg=Fm.value,AY.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",hg,
"musicTrack",0,Ij));return rn.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,AY))}})},Uih=function(m,c){var W,A;
return g.D(function(p){switch(p.j){case 1:return W=Mu(c),g.JY(p,2),A=g.Ng(c.entityKey).entityId,A==="!*$_ALL_ENTITIES_!*$"?g.t(p,yj(m.j,c,m.K),5):g.t(p,Tv(A,"musicAlbumRelease",m.j,c,m.K),6);case 6:return g.t(p,K5S(m.j,c.entityKey),5);case 5:g.H$(p,3);break;case 2:return g.lm(p),p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
W))}})},ibS=function(m,c,W){var A,p,R;
return g.D(function(L){switch(L.j){case 1:return g.t(L,uN9([c]),2);case 2:return A=L.V,g.t(L,k$9(m,A[0],W),3);case 3:return p=L.V,R=Qj(p.thumbnailDetails),g.t(L,Vj(R),4);case 4:return L.return(A[0].videos)}})},k$9=function(m,c,W){var A,p,R,L,M,b,N,Z,F,Q,w,C,x,q;
return g.D(function(y){if(y.j==1){A=c.additionalMetadadatas;p=void 0;if(A&&A.length>0)for(R=g.H(A),L=R.next();!L.done;L=R.next())if(M=L.value,M.offlineMusicPlaylistData){p=M.offlineMusicPlaylistData;break}b=c.playlistId;N=B_H(c);Z=N.mq;F=N.O3;Q=W?(Number(W)*1E3).toString():Date.now().toString();w=c.lastModifiedTimestamp?(Number(c.lastModifiedTimestamp)*1E3).toString():"0";C={id:g.Zk(b,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:F,lastModifiedTimestampMillis:w,addedTimestampMillis:Q,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};x={id:g.Zk(b,"musicAlbumRelease"),title:c.title,audioPlaylistId:b,trackCount:c.totalVideoCount,tracks:Z,downloadMetadata:C.id};p&&(x.thumbnailDetails=(q=p.albumHqThumbnail)!=null?q:p.albumArtistThumbnail,x.artistDisplayName=p.albumArtistDisplayName,x.releaseDate=p.albumReleaseDate,x.contentRating={explicitType:p.albumReleaseExplicitType},x.releaseType=p.albumReleaseType);return g.t(y,iB(m.j,{mode:"readwrite",k$:!0},function(e){var G=S3(e,x,"musicAlbumRelease");
e=S3(e,C,"musicAlbumReleaseDownloadMetadataEntity");return g.dx.all([G,e])}),2)}return y.return(x)})},XTh=function(m,c){this.j=m;
this.K=c},cnh=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y;
return g.D(function(e){switch(e.j){case 1:return W=Mu(c),A=g.Ng(c.entityKey),p=A.entityId,R=[],g.JY(e,2),g.t(e,mjd(m,p),4);case 4:R=e.V;if((L=R)==null||!L.length){e.qh(5);break}return g.t(e,DRr(m.j,c.entityKey),5);case 5:g.H$(e,3);break;case 2:return M=g.lm(e),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.xK&&M.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
e.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,b,N));case 3:return Z=[],g.t(e,N_G(m.j,"musicTrack",R),7);case 7:R=e.V;if(R.length)for(F=g.H(R),Q=F.next();!Q.done;Q=F.next())if(w=Q.value,C=w.offlineVideoData,x=void 0,(x=C)==null?0:x.videoId)q=void 0,y=Number(((q=c.actionMetadata)==null?void 0:q.priority)||0)+1,Z.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",C.videoId,"musicTrack",y,PF,zv(c,C,p)));return e.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,Z))}})},
W8i=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5,X,S,P,V,Y,m4,xh,Wr,er,U5,pd,wi,T,z,d,K,a,c$,RU,LN,v,NK,gE,bm,DQ,NQ,hc,F0,Yy,nn,$S,D5,Ei,Fm,hg,rn,sn,Ve,Qs,K1,ot,BX,ae,uE,ee,kl,S7;
return g.D(function(Ln){switch(Ln.j){case 1:return W=Mu(c),A=c.entityKey,p=g.Ng(A).entityId,R=[],L=!1,p==="!*$_ALL_ENTITIES_!*$"?(L=!0,g.t(Ln,UZ(m.j,"musicPlaylist"),5)):g.t(Ln,Pu(m.j,A,"musicPlaylist"),4);case 4:(M=Ln.V)&&R.push(M);Ln.qh(3);break;case 5:R=Ln.V;case 3:if((b=R)==null||!b.length)return Ln.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));N=g.h(c.actionMetadata,vc4);F=(Z=N)==null?void 0:Z.autoSync;Q=[];C=w=!0;x=!1;q=void 0;if(!L&&F===!1){Ln.qh(6);break}g.JY(Ln,7);return g.t(Ln,
Eca(0,!!F,!0,R),9);case 9:Q=Ln.V;g.H$(Ln,8);break;case 7:y=g.lm(Ln);if(!(y instanceof Error&&y.message==="No data")){y instanceof Error&&y.message==="Empty response body"&&WF(y.message);Ln.qh(8);break}return p==="!*$_ALL_ENTITIES_!*$"?g.t(Ln,yj(m.j,c,m.K),8):g.t(Ln,Tv(p,"musicPlaylist",m.j,c,m.K),8);case 8:if(!Q.length||!L&&Q[0].playlistId!==p)return Ln.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));case 6:if(L){e=[];G=g.H(Q);for(B=G.next();!B.done;B=G.next())u=B.value,u.upToDate||
F&&!u.shouldAutoSyncMetadata||!u.playlistId||(E={autoSync:F},e.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",u.playlistId,"musicPlaylist",0,PF,{musicPlaylistEntityActionMetadata:E})));return Ln.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,e))}Q.length&&(I=Q[0],x=!!I.upToDate,F&&(w=(AY=I.shouldAutoSyncMetadata)!=null?AY:!0,C=(O5=I.shouldAutoSyncVideos)!=null?O5:!0,I.checkInSeconds&&(q=I.checkInSeconds)));if(x||!w)return Ln.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
W));X=[];S=R[0];P=void 0;if(!S.downloadMetadata){Ln.qh(15);break}return g.t(Ln,Pu(m.j,S.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:V=Ln.V,P=Number((m4=(Y=V)==null?void 0:Y.addedTimestampMillis)!=null?m4:"0")/1E3;case 15:return g.JY(Ln,17),g.t(Ln,mjd(m,p,(xh=P)==null?void 0:xh.toString(),q),19);case 19:X=Ln.V;g.H$(Ln,18);break;case 17:Wr=g.lm(Ln);if(!(Wr instanceof Error&&Wr.message==="No data")){if(Wr instanceof Error&&Wr.message==="Empty response body")WF(Wr.message);else return er=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U5="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Wr instanceof g.xK&&Wr.type==="QUOTA_EXCEEDED"&&(er="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",U5="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ln.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,er,U5));Ln.qh(18);break}return g.t(Ln,Tv(p,"musicPlaylist",m.j,c,m.K),18);case 18:if(!C)return Ln.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
W));pd=[];wi=new Map;if((T=X)==null?0:T.length)for(z=g.H(X),d=z.next();!d.done;d=z.next())K=d.value,a=K.offlineVideoData,c$=void 0,((c$=a)==null?0:c$.videoId)&&wi.set(a.videoId,a);RU=new Map;LN=[];if((v=S)==null?0:(NK=v.tracks)==null?0:NK.length)for(gE=g.H(S.tracks),bm=gE.next();!bm.done;bm=gE.next())if(DQ=bm.value,NQ=g.Ng(DQ).entityId)wi.has(NQ)?(RU.set(NQ,wi.get(NQ)),wi.delete(NQ)):LN.push(NQ);F0=Number(((hc=c.actionMetadata)==null?void 0:hc.priority)||0)+1;Yy=g.H(wi.entries());for(nn=Yy.next();!nn.done;nn=
Yy.next())$S=nn.value,D5=g.H($S),Ei=D5.next().value,Fm=D5.next().value,hg=Ei,rn=Fm,pd.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",hg,"musicTrack",F0,PF,zv(c,rn)));sn=g.H(RU.entries());for(Ve=sn.next();!Ve.done;Ve=sn.next())Qs=Ve.value,K1=g.H(Qs),ot=K1.next().value,BX=K1.next().value,ae=ot,uE=BX,pd.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",ae,"musicTrack",F0,PF,zv(c,uE)));ee=g.H(LN);for(kl=ee.next();!kl.done;kl=ee.next())S7=kl.value,pd.push(Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
S7,"musicTrack",0,PF));return Ln.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,pd))}})},An4=function(m,c){var W,A;
return g.D(function(p){switch(p.j){case 1:return W=Mu(c),g.JY(p,2),A=g.Ng(c.entityKey).entityId,A==="!*$_ALL_ENTITIES_!*$"?g.t(p,yj(m.j,c,m.K),5):g.t(p,Tv(A,"musicPlaylist",m.j,c,m.K),6);case 6:return g.t(p,K5S(m.j,c.entityKey),5);case 5:g.H$(p,3);break;case 2:return g.lm(p),p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
W))}})},mjd=function(m,c,W,A){var p,R,L;
return g.D(function(M){switch(M.j){case 1:return g.t(M,uN9([c]),2);case 2:return p=M.V,g.t(M,pmG(m,p[0],W,A),3);case 3:return R=M.V,L=Qj(R.thumbnailDetails),g.t(M,Vj(L),4);case 4:return M.return(p[0].videos)}})},pmG=function(m,c,W,A){var p,R,L,M,b,N,Z,F,Q;
return g.D(function(w){return w.j==1?(p=c.playlistId,R=B_H(c),L=R.mq,M=R.O3,b=W?(Number(W)*1E3).toString():Date.now().toString(),N=c.lastModifiedTimestamp?(Number(c.lastModifiedTimestamp)*1E3).toString():"0",Z={id:g.Zk(p,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:M,lastModifiedTimestampMillis:N,addedTimestampMillis:b,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},F={id:g.Zk(p,"musicPlaylist"),title:c.title,playlistId:p,thumbnailDetails:c.thumbnail,visibility:RjS(c),trackCount:c.totalVideoCount,
tracks:L,downloadMetadata:Z.id},A&&(((Q=F)==null?0:Q.entityMetadata)?F.entityMetadata.nextAutoRefreshIntervalSeconds=String(A):F&&(F.entityMetadata={nextAutoRefreshIntervalSeconds:String(A)})),g.t(w,iB(m.j,{mode:"readwrite",k$:!0},function(C){var x=S3(C,F,"musicPlaylist");C=S3(C,Z,"musicPlaylistDownloadMetadataEntity");return g.dx.all([x,C])}),2)):w.return(F)})},RjS=function(m){switch(m.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},L8h=function(m,c){this.j=m;
this.K=c},$jr=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C;
return g.D(function(x){switch(x.j){case 1:return W=Mu(c),A=g.Ng(c.entityKey),p=A.entityId,R=g.h(c.actionMetadata,Ox9),g.JY(x,2),g.t(x,Md4(m,p,void 0,(L=R)==null?void 0:L.track,(M=R)==null?void 0:M.albumRelease),4);case 4:if((b=R)==null?0:b.playlistId){x.qh(5);break}return g.t(x,DRr(m.j,c.entityKey),5);case 5:g.H$(x,3);break;case 2:return N=g.lm(x),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.xK&&N.type==="QUOTA_EXCEEDED"&&
(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),x.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,Z,F));case 3:w=Number(((Q=c.actionMetadata)==null?void 0:Q.priority)||0)+1;var q=(q=g.h(c.actionMetadata,Ox9))?{playbackDataActionMetadata:{maximumDownloadQuality:q.maximumDownloadQuality}}:void 0;C=Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"playbackData",w,bx4,q);return x.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
W,[C]))}})},NYh=function(m,c){var W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q;
return g.D(function(y){switch(y.j){case 1:return W=Mu(c),A=g.Ng(c.entityKey),p=A.entityId,g.t(y,Pu(m.j,c.entityKey,"musicTrack"),2);case 2:R=y.V;if(!R){L=void 0;y.qh(3);break}return g.t(y,Pu(m.j,R.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:L=y.V;case 3:M=L;if(!R||!M)return y.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W));N=g.h(c.actionMetadata,Ox9);g.JY(y,5);return g.t(y,Md4(m,p,M.addedTimestampMillis,(Z=N)==null?void 0:Z.track,(F=N)==null?void 0:F.albumRelease),
7);case 7:w=Number(((Q=c.actionMetadata)==null?void 0:Q.priority)||0)+1;b=Gv("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",p,"playbackData",w,bx4);g.H$(y,6);break;case 5:C=g.lm(y);if(!(C instanceof Error&&C.message==="No data")){if(C instanceof Error&&C.message==="Empty response body")WF(C.message);else return x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.xK&&C.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),y.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,x,q));y.qh(6);break}return g.t(y,qu(p,m.j,c,m.K),6);case 6:return y.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",W,b?[b]:void 0))}})},Zx4=function(m,c){var W,A;
return g.D(function(p){switch(p.j){case 1:return W=Mu(c),g.JY(p,2),A=g.Ng(c.entityKey).entityId,A==="!*$_ALL_ENTITIES_!*$"?g.t(p,yj(m.j,c,m.K),5):g.t(p,qu(A,m.j,c,m.K),6);case 6:return g.t(p,K5S(m.j,c.entityKey),5);case 5:g.H$(p,3);break;case 2:return g.lm(p),p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",W,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new Dg("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
W))}})},Md4=function(m,c,W,A,p){var R,L,M,b,N,Z;
return g.D(function(F){switch(F.j){case 1:if(R=A){F.qh(2);break}return g.t(F,aia([c]),3);case 3:L=F.V,M=L[0],R=GZv(M);case 2:return g.t(F,obv(m,R,c,p,W),4);case 4:b=F.V;N=b.musicTrackEntity;Z=b.tK;var Q=Qj(N.thumbnailDetails),w=[];Z&&(w=Qj(Z.thumbnailDetails));return g.t(F,Vj(Q.concat(w)),0)}})},obv=function(m,c,W,A,p){var R;
return g.D(function(L){return L.j==1?(p||(p=Date.now().toString()),R={id:g.Zk(W,"musicTrackDownloadMetadataEntity"),playbackData:g.Zk(W,"playbackData"),addedTimestampMillis:p,videoDownloadContextEntity:g.Zk(W,"videoDownloadContextEntity")},A&&(c.albumRelease=A.id),g.t(L,iB(m.j,{mode:"readwrite",k$:!0},function(M){var b=[],N=S3(M,R,"musicTrackDownloadMetadataEntity");b.push(N);N=S3(M,c,"musicTrack");b.push(N);A&&(M=S3(M,A,"musicAlbumRelease"),b.push(M));return g.dx.all(b)}),2)):L.j!=3?g.t(L,Zg(W,"musicTrackDownloadMetadataEntity",
m.j,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):L.return({musicTrackEntity:c,
tK:A})})},UU=function(){EU.apply(this,arguments);
this.W="musicTrack"},F8S=function(m,c,W){c=c===void 0?43200:c;
W=W===void 0?!0:W;var A=A===void 0?!1:A;var p,R;return g.D(function(L){switch(L.j){case 1:if(!m.B.P3())return L.return([]);p=[];g.JY(L,2);return g.t(L,Eca(c,W,A),4);case 4:p=L.V;g.H$(L,3);break;case 2:g.lm(L);case 3:return R=VPS(m,p,W,"musicPlaylist"),L.return(R)}})},Qvc=function(){g.dg.apply(this,arguments);
var m=this;this.events=new g.nm(this);this.Ag=this.player.J();this.Km={XH8:function(){return m.j},
T$:function(){return m.T$()},
z5:function(c){return m.z5(c)}}},gbS=function(m){var c;
m=g.h((c=m.getWatchNextResponse())==null?void 0:c.currentVideoEndpoint,g.YZ);if(m==null?0:m.playlistId)var W=m.playlistId;return W},wmi=function(m,c){var W,A,p,R;
return g.D(function(L){if(L.j==1){W=c.clientPlaybackNonce;A={cpn:W,offlineSourceVisualElement:g.yh(c.il||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};c.V&&(A.videoFmt=Number(c.V.itag));c.L&&(A.audioFmt=Number(c.L.itag));if((p=gbS(c))&&c.videoId){var M=c.videoId;M=p!=="PPSV"?Promise.resolve(!1):m.j.A7(M);L=g.t(L,M,3)}else L=L.qh(2);return L}L.j!=2&&(R=L.V)&&(A.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");m.V=W;g.Q8("offlinePlaybackStarted",A);g.CN(L)})};
g.J(vu,Bu);g.pN.Object.defineProperties(vu.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.j.entityMetadata},
set:function(m){this.j.entityMetadata=m}}});
g.J(Qc9,vu);Qc9.prototype.V=function(){return[]};
g.J(gJX,vu);gJX.prototype.V=function(){return[]};
g.J(wnh,vu);wnh.prototype.V=function(){return[]};
g.J(CnQ,vu);CnQ.prototype.V=function(){return[]};
g.J(Jrh,vu);Jrh.prototype.V=function(){var m=[];this.j.alternateChannel&&m.push(this.j.alternateChannel);this.j.alternateChannelList&&m.push.apply(m,g.l(this.j.alternateChannelList));this.j.oneofChannelEntity&&m.push(this.j.oneofChannelEntity);return[].concat(g.l(new Set(m)))};
g.J(Veh,vu);Veh.prototype.V=function(){var m=[];this.j.entryCollection&&m.push(this.j.entryCollection);return[].concat(g.l(new Set(m)))};
g.J(HWd,Bu);HWd.prototype.V=function(){var m=[];this.j.video&&m.push(this.j.video);return[].concat(g.l(new Set(m)))};
g.J(xNd,vu);xNd.prototype.V=function(){var m=[];this.j.parentPlaylist&&m.push(this.j.parentPlaylist);if(this.j.entries)for(var c=g.H(this.j.entries),W=c.next();!W.done;W=c.next())m.push.apply(m,g.l((new HWd(W.value)).V()));return[].concat(g.l(new Set(m)))};
g.J(l6H,vu);l6H.prototype.V=function(){var m=[];this.j.descriptionEntity&&m.push(this.j.descriptionEntity);this.j.creators&&m.push.apply(m,g.l(this.j.creators));this.j.theBiggestFan&&m.push(this.j.theBiggestFan);return[].concat(g.l(new Set(m)))};
g.J(qPQ,vu);qPQ.prototype.V=function(){return[]};
g.J(T3G,vu);T3G.prototype.V=function(){return[]};
g.J(yrG,vu);yrG.prototype.V=function(){return[]};
g.J(zLr,vu);zLr.prototype.V=function(){return[]};
g.J(eLG,vu);eLG.prototype.V=function(){return[]};
g.J(dNG,vu);dNG.prototype.V=function(){return[]};
g.J(ter,vu);ter.prototype.V=function(){return[]};
g.J(G14,vu);G14.prototype.V=function(){return[]};
g.J(DNX,vu);DNX.prototype.V=function(){return[]};
g.J(K7Q,vu);K7Q.prototype.V=function(){var m=[];this.j.downloadsList&&m.push(this.j.downloadsList);this.j.smartDownloadsList&&m.push(this.j.smartDownloadsList);this.j.recommendedDownloadsList&&m.push(this.j.recommendedDownloadsList);this.j.refresh&&m.push(this.j.refresh);return[].concat(g.l(new Set(m)))};
g.J(B3v,Bu);B3v.prototype.V=function(){var m=[];this.j.video&&m.push(this.j.video);this.j.playlist&&m.push(this.j.playlist);this.j.videoItem&&m.push(this.j.videoItem);this.j.playlistItem&&m.push(this.j.playlistItem);return[].concat(g.l(new Set(m)))};
g.J(vJH,vu);vJH.prototype.V=function(){var m=[];this.j.refresh&&m.push(this.j.refresh);if(this.j.downloads)for(var c=g.H(this.j.downloads),W=c.next();!W.done;W=c.next())m.push.apply(m,g.l((new B3v(W.value)).V()));return[].concat(g.l(new Set(m)))};
g.J(jcc,vu);jcc.prototype.V=function(){var m=[];this.j.localImageEntities&&m.push.apply(m,g.l(this.j.localImageEntities));return[].concat(g.l(new Set(m)))};
g.J(a6h,vu);a6h.prototype.V=function(){var m=[];this.j.playbackData&&m.push(this.j.playbackData);this.j.localImageEntities&&m.push.apply(m,g.l(this.j.localImageEntities));this.j.videoDownloadContextEntity&&m.push(this.j.videoDownloadContextEntity);return[].concat(g.l(new Set(m)))};
g.J(ujv,vu);ujv.prototype.V=function(){return[]};
g.J(nJc,vu);nJc.prototype.V=function(){var m=[];this.j.fakeChildren&&m.push.apply(m,g.l(this.j.fakeChildren));return[].concat(g.l(new Set(m)))};
g.J(rrr,vu);rrr.prototype.V=function(){var m=[];this.j.video&&m.push(this.j.video);this.j.playbackData&&m.push(this.j.playbackData);this.j.offlineVideoPolicy&&m.push(this.j.offlineVideoPolicy);return[].concat(g.l(new Set(m)))};
g.J(hLr,vu);hLr.prototype.V=function(){return[]};
g.J(sc4,vu);sc4.prototype.V=function(){var m=[];this.j.channelOwner&&m.push(this.j.channelOwner);this.j.videos&&m.push.apply(m,g.l(this.j.videos));this.j.collaboratorChannels&&m.push.apply(m,g.l(this.j.collaboratorChannels));this.j.downloadState&&m.push(this.j.downloadState);this.j.refresh&&m.push(this.j.refresh);return[].concat(g.l(new Set(m)))};
g.J(SPa,vu);SPa.prototype.V=function(){var m=[];this.j.video&&m.push(this.j.video);this.j.channelContributor&&m.push(this.j.channelContributor);return[].concat(g.l(new Set(m)))};
g.J(EJa,Bu);EJa.prototype.V=function(){var m=[];this.j.localImageEntities&&m.push.apply(m,g.l(this.j.localImageEntities));this.j.videoDownloadContextEntity&&m.push(this.j.videoDownloadContextEntity);return[].concat(g.l(new Set(m)))};
g.J(YPa,Bu);YPa.prototype.V=function(){var m=[];this.j.recommendedVideoMetadata&&m.push.apply(m,g.l((new EJa(this.j.recommendedVideoMetadata)).V()));return[].concat(g.l(new Set(m)))};
g.J(f6G,Bu);f6G.prototype.V=function(){var m=[];this.j.playbackPosition&&m.push(this.j.playbackPosition);return[].concat(g.l(new Set(m)))};
g.J(iW4,vu);iW4.prototype.V=function(){var m=[];this.j.owner&&m.push(this.j.owner);this.j.downloadState&&m.push(this.j.downloadState);this.j.userState&&m.push.apply(m,g.l((new f6G(this.j.userState)).V()));this.j.additionalMetadata&&m.push.apply(m,g.l((new YPa(this.j.additionalMetadata)).V()));return[].concat(g.l(new Set(m)))};
g.J(I6r,vu);I6r.prototype.V=function(){var m=[];this.j.userChannelDetails&&m.push(this.j.userChannelDetails);return[].concat(g.l(new Set(m)))};
g.J(PnX,vu);PnX.prototype.V=function(){var m=[];this.j.channelOwner&&m.push(this.j.channelOwner);this.j.playbackPosition&&m.push(this.j.playbackPosition);this.j.localImageEntities&&m.push.apply(m,g.l(this.j.localImageEntities));this.j.downloadStatus&&m.push(this.j.downloadStatus);return[].concat(g.l(new Set(m)))};
g.J(UNG,vu);UNG.prototype.V=function(){return[]};
g.J(k1c,vu);k1c.prototype.V=function(){return[]};
g.J(XnH,vu);XnH.prototype.V=function(){return[]};
g.J(mPh,vu);mPh.prototype.V=function(){return[]};
g.J(cBQ,vu);cBQ.prototype.V=function(){return[]};
g.J(WB4,vu);WB4.prototype.V=function(){return[]};
g.J(AB9,vu);AB9.prototype.V=function(){return[]};
g.J(pC9,vu);pC9.prototype.V=function(){return[]};
g.J(Rzh,vu);Rzh.prototype.V=function(){return[]};
g.J(LBS,vu);LBS.prototype.V=function(){return[]};
g.J(OZ4,vu);OZ4.prototype.V=function(){var m=[];this.j.trackDownloadMetadatas&&m.push.apply(m,g.l(this.j.trackDownloadMetadatas));return[].concat(g.l(new Set(m)))};
g.J(MG4,vu);
MG4.prototype.V=function(){var m=[];this.j.downloadedTracks&&m.push.apply(m,g.l(this.j.downloadedTracks));this.j.smartDownloadedTracks&&m.push.apply(m,g.l(this.j.smartDownloadedTracks));this.j.downloadedEpisodes&&m.push.apply(m,g.l(this.j.downloadedEpisodes));this.j.downloadedAlbumReleases&&m.push.apply(m,g.l(this.j.downloadedAlbumReleases));this.j.smartDownloadedAlbumReleases&&m.push.apply(m,g.l(this.j.smartDownloadedAlbumReleases));this.j.downloadedPlaylists&&m.push.apply(m,g.l(this.j.downloadedPlaylists));this.j.smartDownloadedPlaylists&&
m.push.apply(m,g.l(this.j.smartDownloadedPlaylists));this.j.metadataOnlyTracks&&m.push.apply(m,g.l(this.j.metadataOnlyTracks));return[].concat(g.l(new Set(m)))};
g.J(bZh,vu);bZh.prototype.V=function(){var m=[];this.j.trackDownloadMetadatas&&m.push.apply(m,g.l(this.j.trackDownloadMetadatas));return[].concat(g.l(new Set(m)))};
g.J($Pi,vu);$Pi.prototype.V=function(){var m=[];this.j.playbackData&&m.push(this.j.playbackData);this.j.localImageEntities&&m.push.apply(m,g.l(this.j.localImageEntities));this.j.videoDownloadContextEntity&&m.push(this.j.videoDownloadContextEntity);return[].concat(g.l(new Set(m)))};
g.J(NUS,vu);NUS.prototype.V=function(){var m=[];this.j.musicLibraryStatusEntity&&m.push(this.j.musicLibraryStatusEntity);this.j.primaryArtists&&m.push.apply(m,g.l(this.j.primaryArtists));this.j.details&&m.push(this.j.details);this.j.userDetails&&m.push(this.j.userDetails);this.j.tracks&&m.push.apply(m,g.l(this.j.tracks));this.j.share&&m.push(this.j.share);this.j.downloadMetadata&&m.push(this.j.downloadMetadata);this.j.refresh&&m.push(this.j.refresh);return[].concat(g.l(new Set(m)))};
g.J(ZZi,vu);ZZi.prototype.V=function(){var m=[];this.j.albumRelease&&m.push(this.j.albumRelease);this.j.tracks&&m.push.apply(m,g.l(this.j.tracks));return[].concat(g.l(new Set(m)))};
g.J(oYa,vu);oYa.prototype.V=function(){var m=[];this.j.albumRelease&&m.push(this.j.albumRelease);return[].concat(g.l(new Set(m)))};
g.J(FBS,vu);FBS.prototype.V=function(){var m=[];this.j.details&&m.push(this.j.details);this.j.userDetails&&m.push(this.j.userDetails);return[].concat(g.l(new Set(m)))};
g.J(QeQ,vu);QeQ.prototype.V=function(){var m=[];this.j.parentArtist&&m.push(this.j.parentArtist);return[].concat(g.l(new Set(m)))};
g.J(gYr,vu);gYr.prototype.V=function(){var m=[];this.j.parentArtist&&m.push(this.j.parentArtist);return[].concat(g.l(new Set(m)))};
g.J(wCc,vu);wCc.prototype.V=function(){return[]};
g.J(CEa,vu);CEa.prototype.V=function(){return[]};
g.J(JBd,Bu);JBd.prototype.V=function(){var m=[];this.j.creatorEntity&&m.push(this.j.creatorEntity);return[].concat(g.l(new Set(m)))};
g.J(VGG,vu);
VGG.prototype.V=function(){var m=[];this.j.tracks&&m.push.apply(m,g.l(this.j.tracks));this.j.refresh&&m.push(this.j.refresh);this.j.musicLibraryStatusEntity&&m.push(this.j.musicLibraryStatusEntity);this.j.details&&m.push(this.j.details);this.j.downloadMetadata&&m.push(this.j.downloadMetadata);this.j.sideloadMetadata&&m.push(this.j.sideloadMetadata);this.j.userDetails&&m.push(this.j.userDetails);this.j.entryCollection&&m.push(this.j.entryCollection);this.j.share&&m.push(this.j.share);this.j.podcastShowAdditionalMetadata&&m.push.apply(m,
g.l((new JBd(this.j.podcastShowAdditionalMetadata)).V()));return[].concat(g.l(new Set(m)))};
g.J(HZG,vu);HZG.prototype.V=function(){return[]};
g.J(xPh,vu);
xPh.prototype.V=function(){var m=[];this.j.musicLibraryStatusEntity&&m.push(this.j.musicLibraryStatusEntity);this.j.artists&&m.push.apply(m,g.l(this.j.artists));this.j.audioModeVersion&&m.push(this.j.audioModeVersion);this.j.videoModeVersion&&m.push(this.j.videoModeVersion);this.j.userDetails&&m.push(this.j.userDetails);this.j.details&&m.push(this.j.details);this.j.albumRelease&&m.push(this.j.albumRelease);this.j.share&&m.push(this.j.share);this.j.libraryEdit&&m.push(this.j.libraryEdit);this.j.downloadMetadata&&
m.push(this.j.downloadMetadata);this.j.playbackPosition&&m.push(this.j.playbackPosition);this.j.lyrics&&m.push(this.j.lyrics);return[].concat(g.l(new Set(m)))};
g.J(lF4,vu);lF4.prototype.V=function(){var m=[];this.j.parentTrack&&m.push(this.j.parentTrack);return[].concat(g.l(new Set(m)))};
g.J(qAd,vu);qAd.prototype.V=function(){var m=[];this.j.parentTrack&&m.push(this.j.parentTrack);return[].concat(g.l(new Set(m)))};
g.J(TUS,vu);TUS.prototype.V=function(){return[]};
g.J(yB4,vu);yB4.prototype.V=function(){return[]};
g.J(zzc,vu);zzc.prototype.V=function(){return[]};
g.J(ezh,vu);ezh.prototype.V=function(){return[]};
g.J(dPv,vu);dPv.prototype.V=function(){var m=[];this.j.transfer&&m.push(this.j.transfer);this.j.adsPlaybackData&&m.push.apply(m,g.l(this.j.adsPlaybackData));this.j.drmLicense&&m.push(this.j.drmLicense);this.j.offlineVideoPolicy&&m.push(this.j.offlineVideoPolicy);this.j.videoDownloadContextEntity&&m.push(this.j.videoDownloadContextEntity);return[].concat(g.l(new Set(m)))};
g.J(tGd,vu);tGd.prototype.V=function(){return[]};
g.J(GQ9,vu);GQ9.prototype.V=function(){var m=[];this.j.offlineVideoStreams&&m.push.apply(m,g.l(this.j.offlineVideoStreams));this.j.captionTrack&&m.push.apply(m,g.l(this.j.captionTrack));return[].concat(g.l(new Set(m)))};
g.J(DPX,vu);DPX.prototype.V=function(){return[]};
g.J(KBa,vu);KBa.prototype.V=function(){return[]};
g.J(BUi,vu);BUi.prototype.V=function(){return[]};
g.J(vY4,vu);vY4.prototype.V=function(){return[]};
g.J(jev,vu);jev.prototype.V=function(){return[]};
g.J(aF9,vu);aF9.prototype.V=function(){return[]};
g.J(u$i,vu);u$i.prototype.V=function(){return[]};
g.J(nYH,vu);nYH.prototype.V=function(){return[]};
g.J(rBi,vu);rBi.prototype.V=function(){return[]};
g.J(hz4,vu);hz4.prototype.V=function(){return[]};
g.J(seX,vu);seX.prototype.V=function(){return[]};
g.J(SAX,vu);SAX.prototype.V=function(){return[]};
g.J(EYX,vu);EYX.prototype.V=function(){return[]};
g.J(YAX,vu);YAX.prototype.V=function(){return[]};
g.J(fFQ,vu);fFQ.prototype.V=function(){return[]};
g.J(iZv,vu);iZv.prototype.V=function(){return[]};
g.J(IFh,vu);IFh.prototype.V=function(){return[]};
var Yg4=["browse","music/browse","unplugged/browse"],URr=["offline/playlist_sync_check"],j3i=["offline"],fiv=["offline/offline_video_playback_position_sync"],Ii9=["offline/get_playback_data_entity"],j3;ap.getInstance=function(){return g.D(function(m){return m.return(new Promise(function(c){g.pF().then(function(W){W?(ap.instance||(ap.instance=new ap(W)),c(ap.instance)):c(void 0)})}))})};
ap.prototype.get=function(m){var c=this,W,A,p;return g.D(function(R){if(R.j==1)return g.t(R,XC4(c.token),2);if(R.j!=3)return W=R.V,g.t(R,W.get("prefs",m),3);A=R.V;if(!A)return R.return();p=(0,g.Kq)();return A.expirationTimestampMs<=p?R.return():R.return(A.value)})};
ap.prototype.set=function(m,c,W){W=W===void 0?31536E3:W;var A=this,p,R,L;return g.D(function(M){if(M.j==1)return p=(0,g.Kq)(),R={key:m,value:c,expirationTimestampMs:p+W*1E3},g.t(M,XC4(A.token),2);L=M.V;return g.t(M,g.nq(L,"prefs",R),0)})};
ap.prototype.remove=function(m){var c=this,W;return g.D(function(A){if(A.j==1)return g.t(A,XC4(c.token),2);W=A.V;return g.t(A,W.delete("prefs",m),0)})};
g.J(uB,g.X7);g.J(nk,pYr);nk.prototype.K=function(m,c){c=Lgh(c);m=(new TextEncoder).encode(JSON.stringify(m));return this.j.encrypt(m,c)};
nk.prototype.V=function(m,c){if(!(m instanceof Uint8Array))throw mGr(1);var W=new TextDecoder;c=Lgh(c);m=this.j.decrypt(m,c);return JSON.parse(W.decode(m))};
var O$Q={accountLinkStatusEntity:yrG,booleanEntity:wnh,buttonEntity:hz4,captionTrack:TUS,channelHandle:Qc9,commerceAcquisitionClientPayloadEntity:SAX,commerceCartListEntity:EYX,contextNoteFeedEntityPayload:gJX,continuationTokenEntity:hLr,downloadQualityPickerEntity:ter,downloadsPageRefreshTokenEntity:DNX,downloadsPageViewConfigurationEntity:UNG,downloadStatusEntity:G14,sfvAudioItemCurrentlyPlayingEntity:KBa,emojiFountainDataEntity:nYH,emojiCustomizationSetEntity:u$i,fakeChannel:Jrh,fakePlaylist:Veh,
fakePlaylistEntryCollection:xNd,fakeVideo:l6H,fakeVideoDescription:qPQ,featuredProductsEntity:pC9,flowStateEntity:T3G,iconBadgeEntity:YAX,interstitialInteractionStateEntity:eLG,liveChatPollStateEntity:dNG,liveReactionsDataEntity:rBi,logoEntity:zLr,macroMarkerEntity:k1c,mainDownloadsLibraryEntity:K7Q,mainDownloadsListEntity:vJH,mainPlaylistDownloadStateEntity:jcc,mainPlaylistEntity:sc4,mainPlaylistVideoEntity:SPa,mainVideoDownloadStateEntity:a6h,mainVideoEntity:iW4,markersEngagementPanelSyncEntity:XnH,
markersVisibilityOverrideEntity:mPh,musicAlbumReleaseDetail:ZZi,musicAlbumReleaseDownloadMetadataEntity:OZ4,musicAlbumRelease:NUS,musicAlbumReleaseUserDetail:oYa,musicArtistDetail:QeQ,musicArtist:FBS,musicArtistUserDetail:gYr,musicDownloadsLibraryEntity:MG4,musicLibraryEdit:wCc,musicLibraryStatusEntity:CEa,musicPlaylist:VGG,musicPlaylistDownloadMetadataEntity:bZh,musicShare:HZG,musicTrackDetail:lF4,musicTrackDownloadMetadataEntity:$Pi,musicTrack:xPh,musicTrackUserDetail:qAd,offlineOrchestrationActionWrapperEntity:yB4,
offlineVideoPolicy:zzc,offlineVideoStreams:ezh,offlineabilityEntity:ujv,orchestrationWebSamplingEntity:nJc,pageHeaderEntity:jev,pdpStateEntity:fFQ,pinnedProductEntity:Rzh,playbackData:dPv,playerStateEntity:cBQ,quantityIncrementerEntity:iZv,refresh:tGd,saveToPlaylistListEntity:BUi,settingEntity:vY4,stringEntity:CnQ,suggestedFeedbackChipStateEntity:WB4,transfer:GQ9,trendingOfferEntity:LBS,videoDownloadContextEntity:DPX,videoOverviewAsyncDataEntity:IFh,videoPlaybackPositionEntity:seX,votingEntity:aF9,
ytMainChannelEntity:I6r,youchatPendingResponseEntity:AB9,ytMainDownloadedVideoEntity:rrr,ytMainVideoEntity:PnX};g.J(Yu,pYr);Yu.prototype.K=function(m){return m};
Yu.prototype.V=function(m){if(m instanceof Uint8Array)throw mGr(0);return m};
g.J(fk,g.n);fk.prototype.observe=function(m){var c=this;this.observers.push(m);return function(){var W=c.observers.indexOf(m);W>=0&&c.observers.splice(W,1)}};
fk.prototype.V=function(m){H$G(this,m.data)};
fk.prototype.xo=function(){this.channel.close()};
var yki,xR4=new g.Kv("elementsCommand");var xO=new g.Kv("entityBatchUpdate");var $Rc=new g.Kv("downloadStatusEntity");var yd9=new g.Kv("mainPlaylistEntityActionMetadata");var i_=new g.Kv("mainVideoEntityActionMetadata");var vc4=new g.Kv("musicPlaylistEntityActionMetadata");var Ox9=new g.Kv("musicTrackEntityActionMetadata");var hR4=new g.Kv("localImageEntityActionMetadata");var K0=new g.Kv("playbackDataActionMetadata");var lwr=new g.Kv("transferEntityActionMetadata");var MX4=new g.Kv("videoPlaybackPositionEntityActionMetadata");var h0r;new g.ln;new g.ln;fPa.prototype.request=function(m,c,W){c=c===void 0?{}:c;return this.locks.request(m,c,function(A){return W(A)})};var cF=g.um.caches,mV,kja;Xc.prototype.open=function(m){return cF.open(PGv(m))};
Xc.prototype.has=function(m){return cF.has(PGv(m))};
Xc.prototype.delete=function(m){return cF.delete(PGv(m))};
Xc.prototype.match=function(m,c){var W=this,A,p,R,L,M,b;return g.D(function(N){switch(N.j){case 1:return g.t(N,W.keys(),2);case 2:A=N.V,p=g.H(A),R=p.next();case 3:if(R.done){N.qh(5);break}L=R.value;return g.t(N,W.open(L),6);case 6:return M=N.V,g.t(N,M.match(m,c),7);case 7:if(b=N.V)return N.return(b);R=p.next();N.qh(3);break;case 5:return N.return()}})};
g.J(IPh,Xc);IPh.prototype.keys=function(){var m,c,W,A,p,R,L,M,b;return g.D(function(N){if(N.j==1)return m=[],c=g.mn("CacheStorage keys"),g.t(N,cF.keys(),2);W=N.V;A=g.H(W);for(p=A.next();!p.done;p=A.next()){R=p.value;var Z=R.indexOf(":");L=Z===-1?{sx:R}:{sx:R.substring(0,Z),datasyncId:R.substring(Z+1)};M=L.sx;b=L.datasyncId;b===c&&m.push(M)}return N.return(m)})};g.J(Au,g.n);Au.prototype.K=function(m){this.api.r_("onOfflineOperationFailure",m.data)};
Au.prototype.L=function(m){this.api.publish("offlinetransferpause",m.data)};
Au.prototype.xo=function(){var m;(m=this.j)==null||m.close();var c;(c=this.V)==null||c.close()};cU9.prototype.cP=function(){this.j&&Rj(this)};
cU9.prototype.Yc=function(){this.V&&this.V.resolve();this.K=this.j=!1;this.W()};var n4d=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var JUa="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var tfQ="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.J(XGS,tu);XGS.prototype.V=function(m){return b_(m)?Wir(this,m):$O(m)?RCS(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};g.J(LiS,tu);LiS.prototype.V=function(m){return $O(m)?ODv(this,m):boG(m)?bDH(this,m):Nu(m)?$Cc(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};g.O=N6h.prototype;g.O.MQ8=function(m){var c=this,W,A,p,R;return g.D(function(L){if(!g.U(m.state,128))return L.qh(0);W=m.state.ox;var M=(A=W)==null?void 0:A.errorCode,b=(p=W)==null?void 0:p.gE;R=M==="net.connect"&&b===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(M==null?0:M.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.t(L,c.zY(c.player.getVideoData().videoId,R),0)})};
g.O.zY=function(m,c){var W=this;return g.D(function(A){if(A.j==1){if(W.V)return A.return();W.V=!0;return c==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(j6(W,m,!1,!0),A.qh(0)):g.t(A,vF(W,m),3)}g.qU(m,4);return g.t(A,W.j.zY(c),0)})};
g.O.oJ=function(m){m.status===2?(m.status!==this.K&&(ObX(this.j),g.qU(m.videoId,2)),m.QV&&ZbG(this.j,m.videoId,m.QV)):m.status===4?(vF(this,m.videoId),this.zY(m.videoId,m.I_?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):m.status===1&&NJc(this.j);this.K=m.status;this.api.r_("localmediachange",{videoId:m.videoId,status:m.status})};
g.O.Xn=function(){var m=this,c;return g.D(function(W){if(W.j==1){if(m.V)return W.return();m.V=!0;c=m.player.getVideoData().videoId;return g.t(W,vF(m,c),2)}return g.t(W,m.j.Xn(),0)})};
g.O.f$=function(m){switch(m){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.O.G=function(m){return this.api.J().G(m)};g.J(Cbd,tu);Cbd.prototype.V=function(m){return b_(m)?VXh(this,m):$O(m)?HDG(this,m):boG(m)?xCv(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};eCS.prototype.j=function(m,c){var W=m.action.actionMetadata.priority-c.action.actionMetadata.priority;W===0&&(m.j<c.j?W=-1:m.j>c.j&&(W=1));return W};g.J(aj,g.n);aj.prototype.xo=function(){this.W&&this.W();g.n.prototype.xo.call(this)};
aj.prototype.createAction=function(m,c){var W=g.Ng(m.entityKey).entityType,A=g.zf(16);return new gP(W,A,m,c.actionId,c.rootActionId)};
aj.prototype.Mh=function(m){var c=this,W,A,p,R,L,M,b,N,Z;return g.D(function(F){if(F.j==1){if(c.Bs())return F.return();A=(W=m.offlineOrchestrationActionWrapperEntity)!=null?W:new Set;p=[];R=g.H(A);for(L=R.next();!L.done;L=R.next())M=L.value,b=g.Ng(M),N=b.entityId,Gbc(c.j,N)||p.push(M);return g.t(F,sEr(c,p),2)}Z=F.V;return g.t(F,hCv(c,Z),0)})};
aj.prototype.retry=function(){var m=this;return g.D(function(c){return g.t(c,SFX(m),0)})};YFS.prototype.YH=function(m,c){c=c===void 0?!0:c;var W=this,A,p,R,L,M,b,N,Z;return g.D(function(F){switch(F.j){case 1:if(!W.j)return F.return();A=[];p=g.wg(W.j.V,c);R=[];for(L={AU:0};L.AU<p.length;L={AU:L.AU},L.AU++)M=p[L.AU],b=W.j.Ch(M,"json3"),N=g.jY(b,{withCredentials:!0,format:"RAW"},3,500).then(function(Q){return function(w){w={metadata:g.bM(p[Q.AU]),trackData:w.xhr.responseText};R.push(w)}}(L)).dG(function(Q){WF("Caption fetch error",Q)}),A.push(N);
return g.t(F,F7Q(A),2);case 2:return g.JY(F,3),g.t(F,Be4(m,R),5);case 5:g.H$(F,0);break;case 3:Z=g.lm(F),WF("Caption DB transaction error",Z),g.CN(F)}})};g.J(u_,g.n);u_.prototype.xo=function(){this.V&&this.V();g.n.prototype.xo.call(this)};
u_.prototype.K=function(m){var c=this,W,A,p,R,L,M,b,N;return g.D(function(Z){A=(W=m.transfer)!=null?W:new Set;p=[];R=g.H(A);for(L=R.next();!L.done;L=R.next())M=L.value,b=g.Ng(M),N=b.entityId,p.push(N);return p.length===0?Z.return():g.t(Z,Iwv(c,p),0)})};g.J(miX,g.n);g.O=miX.prototype;g.O.xo=function(){this.Kf&&this.Kf();this.De.dispose();this.L.dispose();this.Cf&&g.iS(this.B.Oj,this.Cf);this.Rq&&g.iS(this.B.Oj,this.Rq);g.n.prototype.xo.call(this)};
g.O.DQ9=function(m){var c=this,W,A,p;return g.D(function(R){switch(R.j){case 1:W=g.Zk(m,"transfer");if(c.j&&W===c.j.key){j6(c.X,c.U,!0);c.L.stop();R.qh(0);break}return g.t(R,iB(c.V,{mode:"readwrite",k$:!0},function(L){return rW(L,W,"transfer").then(function(M){if(M&&M.transferState!=="TRANSFER_STATE_COMPLETE"&&M.transferState!=="TRANSFER_STATE_FAILED")return M.transferState="TRANSFER_STATE_PAUSED_BY_USER",S3(L,M,"transfer").then(function(){return M})})}),3);
case 3:A=R.V;if(!A){R.qh(0);break}if(!m||!c.K){R.qh(5);break}return g.t(R,Zg(m,c.K,c.V,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.t(R,hu(c,m),7);case 7:p=R.V,OoH({videoId:m,gr:A,offlineModeType:p}),g.CN(R)}})};
g.O.LYo=function(){var m=this;if(this.j&&this.U){j6(this.X,this.U,!1);var c=this.j,W=(c==null?0:c.key)?g.Ng(c.key).entityId:"";W&&this.K&&(new Promise(function(A,p){Zg(W,m.K,m.V,"DOWNLOAD_STATE_PAUSED").catch(function(R){p(R)})})).catch(function(A){WF("Download state setting error",A)})}this.L.stop()};
g.O.vM=function(){this.j?AdS(this,this.j):rP(this)};
g.O.ZP=function(m){var c=this;return g.D(function(W){switch(W.j){case 1:if(!c.j){W.qh(2);break}if(c.j.transferState==="TRANSFER_STATE_COMPLETE"||c.j.transferState==="TRANSFER_STATE_FAILED"||!m.transfer||!m.transfer.has(c.j.key)){W.qh(3);break}return g.t(W,Pu(c.V,c.j.key,"transfer"),4);case 4:c.j=W.V;if(c.j){W.qh(3);break}return g.t(W,pTG(c),3);case 3:if(c.j)return W.return();case 2:return g.t(W,rP(c),0)}})};
g.O.zY=function(m,c){var W=this,A,p,R,L,M;return g.D(function(b){switch(b.j){case 1:if(!W.j){sU(W,"onTransferFailure: "+m);b.qh(2);break}A=W.j;R=((p=A)==null?0:p.key)?g.Ng(A.key).entityId:"";a:switch(m){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var N=!1;break a;default:N=!0}return N&&oxG(W)?g.t(b,S6(W,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.t(b,
F$v(W,m),5);case 5:if(!R||!W.K){b.qh(2);break}return g.t(b,Zg(R,W.K,W.V,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.t(b,hu(W,R),9);case 9:L=b.V;OU({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:R,gr:A,offlineModeType:L});if(!R||!W.K){b.qh(2);break}return g.t(b,Zg(R,W.K,W.V,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:n0(W),M=rP(W,!0),c&&c(M),g.CN(b)}})};
g.O.Xn=function(m){var c=this,W,A,p,R,L,M,b,N,Z,F,Q,w;return g.D(function(C){switch(C.j){case 1:if(!c.j){sU(c,"onMaybeTransferStreamsExpired");C.qh(2);break}return oxG(c)?g.t(C,S6(c,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.t(C,F$v(c,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!c.K){C.qh(2);break}W=c.j;p=((A=W)==null?0:A.key)?g.Ng(W.key).entityId:"";if(!p){C.qh(2);break}return g.t(C,Zg(p,c.K,c.V,"DOWNLOAD_STATE_FAILED"),2);case 9:return c.j||sU(c,"onMaybeTransferStreamsExpiredRetryAttempting"),
R=c.j,M=((L=R)==null?0:L.key)?g.Ng(R.key).entityId:"",g.t(C,hu(c,M),10);case 10:return b=C.V,OU({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:M,gr:R,offlineModeType:b}),N=ocS(),g.Sy(N,K0,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Z=g.Zk(M,"playbackData"),F={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:Z,actionMetadata:N},Q=C0(new gP("playbackData",M,F)),g.t(C,Ip(c.V,Q,"offlineOrchestrationActionWrapperEntity"),2);case 2:n0(c),w=rP(c,!0),
m&&m(w),g.CN(C)}})};
var C$h={},Q99=(C$h.TRANSFER_STATE_TRANSFERRING=1,C$h.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,C$h);g.O=EU.prototype;g.O.o3=function(){return this.U.promise};
g.O.YB=function(){if(this.V&&this.X)return this.U.promise;CO4(this).then(this.U.resolve).catch(this.U.reject);return this.U.promise};
g.O.Im=function(m){var c={};return c.playbackData=new XGS(m,this.Ag,this.j),c.transfer=new Cbd(m,this.Ag),c.videoPlaybackPositionEntity=new LiS(m,this.Ag),c};
g.O.jd=function(){var m=this;return g.D(function(c){return m.V?g.t(c,cdv(m.V),0):c.qh(0)})};
g.O.F5=function(){var m=this,c,W;return g.D(function(A){if(A.j==1)return m.V||m.X?g.t(A,m.o3(),2):A.return();m.N!==void 0&&(g.Tc(m.N),m.N=void 0);m.L!==void 0&&(g.Tc(m.L),m.L=void 0);(c=m.V)==null||c.dispose();m.V=void 0;(W=m.X)==null||W.dispose();m.X=void 0;m.api.r_("onOrchestrationLostLeader");m.U=new g.ln;g.CN(A)})};
g.O.isOrchestrationLeader=function(){return this.K.j};
g.O.A7=function(){return g.D(function(m){return m.return(!1)})};
g.O.xT=function(m){var c=this.j;c.api.publish("offlinetransferpause",m);var W;(W=c.V)==null||W.postMessage(m)};
g.O.vM=function(m){var c,W;return g.D(function(A){if(A.j==1)return g.t(A,ku(),2);c=A.V;if(!c)return A.return();W=g.Zk(m,"transfer");return g.t(A,iB(c,{mode:"readwrite",k$:!0},function(p){var R=rW(p,W,"transfer"),L=rW(p,g.Zk(m,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.dx.all([R,L]).then(function(M){M=g.H(M);var b=M.next().value;var N=M.next().value;return b&&b.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(b.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",S3(p,b,"transfer").then(function(){OU({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:m,gr:b,offlineModeType:N==null?void 0:N.offlineModeType});return g.dx.resolve(null)})):g.dx.resolve(null)})}),0)})};
g.O.Pd=function(m){m=m===void 0?43200:m;var c=this,W,A,p,R,L,M,b,N;return g.D(function(Z){if(Z.j==1)return c.B.P3()?g.t(Z,ku(),2):Z.return(Jd9());if(Z.j!=3){W=Z.V;if(!W)return Z.return([]);A=Date.now()/1E3;return g.t(Z,UZ(W,"offlineVideoPolicy"),3)}p=Z.V;R=[];L=g.H(p);for(M=L.next();!M.done;M=L.next())b=M.value,Number(b.lastUpdatedTimestampSeconds)+m<=A&&(N=g.Ng(b.key).entityId,R.push(N));return R.length?Z.return(YO(c,R,c.W,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):Z.return([])})};
g.O.deleteAll=function(){return YO(this,["!*$_ALL_ENTITIES_!*$"],this.W,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.O.refreshAllStaleEntities=function(m){var c=this;return g.D(function(W){return W.j==1?g.t(W,c.Pd(m),2):W.return(W.V)})};
g.O.setUpPositionSyncInterval=function(m){var c=this;this.L!==void 0&&(g.Tc(this.L),this.L=void 0);var W=m!=null?m:864E5;this.L=g.lT(function(){c.k7(W)},W)};
g.O.k7=function(m){var c=this,W,A,p,R,L,M;return g.D(function(b){switch(b.j){case 1:return g.JY(b,2),g.t(b,ap.getInstance(),4);case 4:W=b.V;if(!W)throw Error("prefStorage is undefined");return g.t(b,W.get("psi"),5);case 5:A=b.V;R=((p=A)==null?0:p.UL)?Number(A.UL)/1E3:0;L=Date.now();if(!(R+m<=L)){b.qh(6);break}return g.t(b,YO(c,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.H$(b,0);break;case 2:M=g.lm(b),WF("Offline manager error",M),
g.CN(b)}})};
g.O.Fm=function(){var m=this,c,W,A,p,R,L,M;return g.D(function(b){if(b.j==1)return g.t(b,ku(),2);if(b.j!=3)return(c=b.V)?g.t(b,UZ(c,"transfer"),3):b.return([]);W=b.V;A=[];p=g.H(W);for(R=p.next();!R.done;R=p.next())L=R.value,L.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&L.key&&(M=g.Ng(L.key).entityId,A.push(M));return b.return(Hb4(m,A))})};
g.O.b5=function(){return g.D(function(m){return m.return([])})};
g.O.aC=function(){return g.D(function(m){g.CN(m)})};
g.O.LU=function(){return g.D(function(m){g.CN(m)})};g.J(xia,tu);xia.prototype.V=function(m){return b_(m)?TJ9(this,m):$O(m)?zRh(this,m):Nu(m)?eRr(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};
var f0=[10];g.J(K$4,tu);K$4.prototype.V=function(m){return b_(m)?j9H(this,m):$O(m)?a8h(this,m):Nu(m)?u89(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};
var vxv=[10];g.J(rdi,tu);rdi.prototype.V=function(m){return $O(m)?s9H(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};g.J(SVX,EU);g.O=SVX.prototype;g.O.Im=function(m){var c=EU.prototype.Im.call(this,m);c.mainVideoEntity=new K$4(m,this.Ag,this.j);c.mainPlaylistEntity=new xia(m,this.Ag,this.j);c.mainDownloadsListEntity=new rdi(m,this.Ag,this.j);return c};
g.O.refreshAllStaleEntities=function(m,c){var W=this,A,p,R,L,M,b,N,Z,F,Q,w;return g.D(function(C){switch(C.j){case 1:A=[];if(!W.Ag.G("web_player_offline_playlist_auto_refresh")){C.qh(2);break}return g.t(C,Exc(W,m,c),3);case 3:A=C.V;case 2:return g.t(C,ap.getInstance(),4);case 4:return p=C.V,g.t(C,(R=p)==null?void 0:R.get("sdois"),5);case 5:return L=C.V,g.t(C,(M=p)==null?void 0:M.get("lmqf"),6);case 6:b=C.V;if(!L){C.qh(7);break}Z=A;F=Z.concat;return g.t(C,YV4(W,L,(N=b)!=null?N:"SD",m===0),8);case 8:A=
F.call(Z,C.V);case 7:return Q=A,w=Q.concat,g.t(C,EU.prototype.refreshAllStaleEntities.call(W,m,c),9);case 9:return A=w.call(Q,C.V),C.return(A)}})};
g.O.A7=function(m){var c,W,A,p,R,L,M,b;return g.D(function(N){if(N.j==1)return g.t(N,ku(),2);if(N.j!=3)return(c=N.V)?g.t(N,Pu(c,g.GT,"mainDownloadsListEntity"),3):N.return(!1);W=N.V;if((A=W)==null?0:(p=A.downloads)==null?0:p.length)for(R=g.Zk(m,"mainVideoEntity"),L=g.H(W.downloads),M=L.next();!M.done;M=L.next())if(b=M.value,b.videoItem===R)return N.return(!0);return N.return(!1)})};
g.O.b5=function(){var m=this,c,W,A,p,R,L,M,b;return g.D(function(N){if(N.j==1)return g.t(N,ku(),2);if(N.j!=3)return(c=N.V)?g.t(N,UZ(c,"downloadStatusEntity"),3):N.return([]);W=N.V;A=[];p=g.H(W);for(R=p.next();!R.done;R=p.next())L=R.value,L.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&L.key&&(M=g.Ng(L.key).entityId,A.push(M));return A.length?(b={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},N.return(YO(m,A,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
b))):N.return([])})};
g.O.LU=function(){var m;return g.D(function(c){return c.j==1?g.t(c,ku(),2):(m=c.V)?g.t(c,iB(m,{mode:"readwrite",k$:!0},function(W){return hO(W,"mainVideoEntity").then(function(A){var p=[];A=g.H(A);for(var R=A.next();!R.done;R=A.next()){R=R.value;var L=void 0;(L=R.userState)!=null&&L.playbackPosition||(L=g.Ng(R.key).entityId,L={key:g.Zk(L,"videoPlaybackPositionEntity"),videoId:L,lastPlaybackPositionSeconds:"0"},p.push(S3(W,L,"videoPlaybackPositionEntity")),R.userState={playbackPosition:L.key},p.push(S3(W,
R,"mainVideoEntity")))}return g.dx.all(p)})}),0):c.return()})};
g.O.aC=function(){var m,c,W,A,p,R,L,M,b,N,Z,F,Q,w,C,x,q,y,e,G,B,u,E,I,AY,O5,X,S,P,V,Y,m4,xh,Wr,er,U5,pd,wi;return g.D(function(T){if(T.j==1)return g.t(T,ku(),2);if(T.j!=3){m=T.V;if(!m)return T.return();c=g.Zk("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.t(T,iB(m,{mode:"readonly",k$:!0},function(z){return g.dx.all([rW(z,c,"mainDownloadsListEntity"),rW(z,g.GT,"mainDownloadsListEntity"),hO(z,"mainVideoEntity"),hO(z,"mainPlaylistEntity")])}),3)}W=T.V;
A=g.H(W);p=A.next().value;R=A.next().value;L=A.next().value;M=A.next().value;b=p;N=R;Z=L;F=M;Q=new Set;if((w=b)==null?0:(C=w.downloads)==null?0:C.length)for(x=g.H(b.downloads),q=x.next();!q.done;q=x.next())y=q.value,e=void 0,(G=(e=y.videoItem)!=null?e:y.playlistItem)&&Q.add(G);if((B=N)==null?0:(u=B.downloads)==null?0:u.length)for(E=g.H(N.downloads),I=E.next();!I.done;I=E.next())AY=I.value,AY.videoItem&&Q.add(AY.videoItem);O5=new Set;X=[];S=g.H(F);for(P=S.next();!P.done;P=S.next()){V=P.value;if(V.videos)for(Y=
g.H(V.videos),m4=Y.next();!m4.done;m4=Y.next())xh=m4.value,(Wr=JSON.parse(g.Ng(xh).entityId).videoId)&&O5.add(Wr);V.key&&!Q.has(V.key)&&X.push(V.key)}er=g.H(Z);for(U5=er.next();!U5.done;U5=er.next())pd=U5.value,pd.key&&!Q.has(pd.key)&&(wi=g.Ng(pd.key).entityId,O5.has(wi)||X.push(pd.key));return X.length?g.t(T,yU9(m,X),0):T.qh(0)})};g.J(f8H,tu);f8H.prototype.V=function(m){return b_(m)?I84(this,m):$O(m)?POd(this,m):Nu(m)?Uih(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};
var Ij=[10];g.J(XTh,tu);XTh.prototype.V=function(m){return b_(m)?cnh(this,m):$O(m)?W8i(this,m):Nu(m)?An4(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};
var PF=[10];g.J(L8h,tu);L8h.prototype.V=function(m){return b_(m)?$jr(this,m):$O(m)?NYh(this,m):Nu(m)?Zx4(this,m):Promise.reject(Error("Unsupported action type: "+m.actionType))};
var bx4=[10];g.J(UU,EU);UU.prototype.Im=function(m){var c=EU.prototype.Im.call(this,m);c.musicTrack=new L8h(m,this.j);c.musicPlaylist=new XTh(m,this.j);c.musicAlbumRelease=new f8H(m,this.j);return c};
UU.prototype.refreshAllStaleEntities=function(m,c){var W=this,A,p,R;return g.D(function(L){if(L.j==1)return g.t(L,F8S(W,m,c),2);if(L.j!=3)return p=A=L.V,R=p.concat,g.t(L,EU.prototype.refreshAllStaleEntities.call(W,m,c),3);A=R.call(p,L.V);return L.return(A)})};g.J(Qvc,g.dg);g.O=Qvc.prototype;g.O.create=function(){var m=this;g.r(this,this.events);g.Er(this.Ag)?this.j=new SVX(this.Ag,this.player):g.hK(this.Ag)&&(this.j=new UU(this.Ag,this.player));this.events.S(this.player,"onPlaybackStartExternal",function(){m.T$()});
this.events.S(this.player,"videodatachange",function(){m.T$()});
this.Ag.G("html5_offline_playback_position_sync")&&this.events.S(this.player,"presentingplayerstatechange",this.z5)};
g.O.yf=function(){return!1};
g.O.sO=function(m,c,W,A){var p=this;return g.D(function(R){return p.j?R.return(YO(p.j,m,c,W,A)):R.return(Promise.reject())})};
g.O.deleteAll=function(){return this.j.deleteAll()};
g.O.Pd=function(m){return this.j.Pd(m)};
g.O.refreshAllStaleEntities=function(m){return this.j.refreshAllStaleEntities(m)};
g.O.setUpPositionSyncInterval=function(m){this.j.setUpPositionSyncInterval(m)};
g.O.xT=function(m){this.j.xT(m)};
g.O.vM=function(m){return this.j.vM(m)};
g.O.T$=function(){var m=this,c;return g.D(function(W){c=m.player.getVideoData();return g.E2(c)?gbS(c)&&m.V!==c.clientPlaybackNonce?g.t(W,wmi(m,c),0):W.qh(0):W.return()})};
g.O.z5=function(m){var c=this,W,A,p,R,L,M,b;return g.D(function(N){if(N.j==1)return W=c.player.getVideoData(),A=W.HZ,g.JK(m,2)||g.JK(m,512)?g.t(N,ku(),2):N.return();if(N.j!=3){p=N.V;if(!p)return WF("PES is undefined"),N.return();R=W.videoId;return g.t(N,Pu(p,g.Zk(R,"mainVideoEntity"),"mainVideoEntity"),3)}L=N.V;if(!L)return N.return();M=Math.floor(A).toString();b={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:M}};return g.t(N,c.sO([R],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
b),0)})};
g.O.isOrchestrationLeader=function(){return this.j.isOrchestrationLeader()};
g.O.updateDownloadState=function(m,c){var W,A,p,R;return g.D(function(L){if(L.j==1)return g.t(L,ku(),2);W=L.V;if(!W)return WF("PES is undefined"),L.return();A=g.Ng(m);p=A.entityType;R=A.entityId;return g.t(L,Zg(R,p,W,c,!0),0)})};g.e$("offline",Qvc);})(_yt_player);
